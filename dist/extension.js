"use strict";var A=(r,n)=>()=>(n||r((n={exports:{}}).exports,n),n.exports);var y=A(c=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0});c.REGEX=c.KEYWORDS=c.TRENNER=c.NO_SPACE_ITEMS=c.DOUBLE_OPERATORS=c.SINGLE_OPERATORS=c.FORMATS=c.BACKSLASH=c.SQUOTE=c.DQUOTE=c.CRLF=c.LF=c.CR=c.TAB=void 0;c.TAB="	";c.CR="\r";c.LF=`
`;c.CRLF=`\r
`;c.DQUOTE='"';c.SQUOTE="'";c.BACKSLASH="\\";c.FORMATS=[c.TAB,c.CR,c.LF,c.CRLF,c.DQUOTE,c.SQUOTE,c.BACKSLASH];c.SINGLE_OPERATORS=["=","+","-","<",">","*","/","%","!","~","|"];c.DOUBLE_OPERATORS=["==","<>","<=",">="];c.NO_SPACE_ITEMS=["(",")","[","]",";"];c.TRENNER=[";"," "];c.KEYWORDS=["NULL","EOF","AS","IF","ENDIF","ELSE","WHILE","FOR","next","DIM","THEN","EXIT","EACH","STEP","IN","RETURN","CALL","MOD","AND","NOT","IS","OR","XOR","Abs","TO","SHL","SHR","discrete","integer","real","message","sqr","sin","cos","tan","atn","exp","log","int","frac","round","rnd","sqrt"];var X=new RegExp(/(?![^{]*})\t/,"gm"),j=new RegExp(/\s{1,}/,"gm"),Z=new RegExp(/\s{2,}/,"gm"),q=new RegExp(/\s{2,}(?<!\t)/,"gm"),Q=new RegExp(/(}*{)/,"g"),Y=new RegExp(/(})/,"g"),J=new RegExp(/^\s*/,"g"),ee=new RegExp(/(["'])(?:(?=(\\?))\2.)*?\1/,"gm"),te=new RegExp(/\s+(?=(?:(?:[^"]*"){2})*[^"]*"[^"]*$)/,"gm"),ne=new RegExp(/(-?\d*\.\d\w*)|([^\`\~\!\@\#\%\^\&\*\(\)\-\=\+\[\{\]\}\\\|\;\:\'\\"\,\.\<\>\/\?\s]+)/,"gm"),ie=new RegExp(/-?\d*\d/,"gm");c.REGEX={gm_TAB_NOT_IN_COMMENT:X,gm_MOR_1_WSP:j,gm_MOR_2_WSP:Z,g_CHECK_OPEN_COMMENT:Q,g_CHECK_CLOSE_COMMENT:Y,gm_GET_NESTING:J,gm_GET_STRING:ee,gm_GET_WSP_IN_STRING:te,gm_MOR_2_WSP_NO_TAB:q,gm_GET_ALL_WORDS:ne,gm_GET_ALL_Numbers:ie}});var M=A(L=>{"use strict";Object.defineProperty(L,"__esModule",{value:!0});L.NESTINGS=L.EXCLUDE_KEYWORDS=void 0;L.EXCLUDE_KEYWORDS=["EXIT FOR"];L.NESTINGS=[{keyword:"if",middle:"else",end:"endif",multiline:"then"},{keyword:"for",middle:"",end:"next",multiline:""},{keyword:"while",middle:"",end:"next",multiline:""}]});var D=A(b=>{"use strict";Object.defineProperty(b,"__esModule",{value:!0});b.preFormat=z;b.formatNestings=G;b.pureFormatPipeline=re;var d=y(),$=M();function z(r,n){r=r.replace(/\r\n|\n|\r/g,`\r
`);let s=r.split(""),e="",l=0,f=!1,C=!1,T=1,S=0;for(let i=0;i<=s.length-1;i++)if(S++,l>0)l--;else{if(l=0,C&&s[i]==='"'?C=!1:!f&&s[i]==='"'&&(C=!0),s[i]===`
`){if(C)return r;T++,S=0}if(!f&&s[i]==="}")return r;if(s[i]==="{"?f=!0:f&&s[i]==="}"&&(f=!1),!C&&!(l>0)&&(!f||n.KeywordUppercaseAlsoInComment)){for(let w of d.KEYWORDS){let _=r.substr(i,w.length),o=r[i-1],R=r[i+w.length];if(_.toLowerCase()===w.toLowerCase()&&v(o)&&v(R)){e+=w.toUpperCase(),l=w.length-1;break}}if(!(l>0)){for(let w of d.DOUBLE_OPERATORS)if(r.substr(i,w.length)===w){r[i-1]!==" "&&(e+=" "),e+=w,r[i+w.length]!==" "&&(e+=" "),l=w.length-1;break}}if(!(l>0)){let w=R=>/[A-Za-z0-9_$]/.test(R||""),_=R=>/[A-Za-z]/.test(R||""),o=R=>/[A-Za-z0-9$-]/.test(R||"");for(let R of d.SINGLE_OPERATORS){if(s[i]!==R)continue;if(R==="-"){let t=r[i-1],m=r[i+1];if(o(t)&&o(m)){let p=i-1;for(;p>=0&&o(r[p]);)p--;p++;let x=i+1;for(;x<r.length&&o(r[x]);)x++;let pe=r.slice(p,x);if(_(r[p])){e+="-",l=-1;break}}}let u=!1;if(R==="-"){let t=e.length-1;for(;t>=0&&/[ \t]/.test(e[t]);)t--;let m=t>=0?e[t]:void 0,p=r[i+1];(m===void 0||/[=+\-*/,(;{}]/.test(m)||m===`
`||m==="\r")&&/[0-9]/.test(p)&&(u=!0)}let E=!(R==="-"&&u);if(E&&e.length>0&&!/[ \t\r\n]/.test(e[e.length-1])&&(e+=" "),e+=R,E){let t=r[i+1];t&&!/[ \t\r\n]/.test(t)&&(e+=" ")}l=-1;break}}}l===0&&(e+=s[i])}e=e.replace(/\r\r\n/g,d.CRLF).replace(/\r(?!\n)/g,"");let F=e.split(d.CRLF).map(i=>i.replace(/\s+$/g,"")),N=[],I=0;for(let i of F)if(i===""){I++,I===1&&N.push("");continue}else I=0,N.push(i);let g=N.join(d.CRLF);return g=(()=>{let i="",w=!1,_=!1,o=0,R=u=>/[A-Za-z]/.test(u);for(let u=0;u<g.length;u++){let E=g[u];if(E==='"'){w=!w,i+=E;continue}if(!w){if(E==="{"){_=!0,i+=E;continue}if(E==="}"&&_&&(_=!1),!_&&(E==="i"||E==="I")&&(g[u+1]==="f"||g[u+1]==="F")){let t=u+2;for(;t<g.length&&g[t]===" ";)t++;if(g[t]==="("){i+="IF (";let m=t+1;for(;m<g.length&&g[m]===" ";)m++;o=1,u=m-1;continue}}if(!_&&E===")"){if(o>0){for(;i.length>0&&i[i.length-1]===" ";)i=i.slice(0,-1);o=0}i+=")";let t=u+1;for(;t<g.length&&g[t]===" ";)t++;if(g.slice(t,t+4).toLowerCase()==="then"){i+=" THEN",u=t+3;continue}let p=g[u+1];p&&R(p)&&(i+=" ");continue}if(!_&&(E==="T"||E==="t")&&g.slice(u,u+4).toLowerCase()==="then"){let t=u+4;for(;t<g.length&&g[t]===" ";)t++;if(g[t]==="{"){i+="THEN ",u=u+3;continue}}if(!_&&E===";"){let t=g[u+1];if(t&&t!==" "&&t!=="\r"&&t!==`
`){i+="; ";continue}}if(E==="}"){let t=u+1;for(;t<g.length&&g[t]===" ";)t++;if(t<g.length&&R(g[t])&&g[u+1]!==" "){i+="} ";continue}}if(!_&&/[A-Za-z0-9_]/.test(E)&&g[u+1]===" "&&g[u+2]==="-"&&/[A-Za-z_]/.test(g[u+3])){let t=i.length-1;for(;t>=0&&/[A-Za-z0-9$-]/.test(i[t]);)t--;let m=u+3;for(;m<g.length&&/[A-Za-z0-9$-]/.test(g[m]);)m++;let p=i.slice(t+1)+g.slice(u,m);if(!/^[A-Za-z][A-Za-z0-9$-]*-[A-Za-z0-9$-]*-[A-Za-z0-9$-]*$/.test(p)){i+=E+" - "+g[u+3],u+=3;continue}}if(!_&&E===","){for(;i.length>0&&i[i.length-1]===" ";)i=i.slice(0,-1);i+=",";let t=g[u+1];t&&t!==" "&&t!==")"&&t!=="\r"&&t!==`
`&&(i+=" ");continue}}i+=E}return i.replace(/= {2,}>/g,"= >")})(),g}function G(r,n){let s="",e=[],l="",f=0,C=0,T=!1,S=!1,F=`^${n.BlockCodeBegin}`,N=`^${n.BlockCodeExclude}`,I=`^${n.BlockCodeEnd}`,g=`^${n.RegionBlockCodeBegin}`,i=`^${n.RegionBlockCodeExclude}`,w=`^${n.RegionBlockCodeEnd}`,_=r.endsWith(d.CRLF);e=r.split(d.CRLF);for(let o=0;o<e.length;o++){let R=!1;e[o]=e[o].replace(/\s+$/g,""),e[o]===""&&(R=!0),e[o].search(d.REGEX.g_CHECK_OPEN_COMMENT)!==-1&&(T=!0),e[o].search(d.REGEX.g_CHECK_CLOSE_COMMENT)!==-1&&(T=!1);let u=e[o].match(d.REGEX.gm_GET_STRING);if(u){let E=e[o];for(let t of u){let m=t.replace(/\s(?<!\t)/gim,"\0");m=m.replace(/\t/gim,"u0001"),m=m.replace(/;/g,"u0002"),E=E.replace(t,m)}if(e[o]=E.replace(d.REGEX.gm_MOR_2_WSP," "),!T){for(let t in d.NO_SPACE_ITEMS)l=`((?![^{]*})\\s\\${d.NO_SPACE_ITEMS[t]})`,e[o]=e[o].replace(new RegExp(l,"g"),`${d.NO_SPACE_ITEMS[t]}`),l=`((?![^{]*})(\\${d.NO_SPACE_ITEMS[t]}\\s))`,e[o]=e[o].replace(new RegExp(l,"g"),`${d.NO_SPACE_ITEMS[t]}`);e[o]=e[o].replace(/(?![^{]*});(?!\s)/g,"; "),e[o]=e[o].replace(/\s+;/g,";")}e[o]=e[o].replace(/\0/gim," ").replace(/u0001/gim,"	").replace(/u0002/gim,";")}if(!R&&!T){let E=!1;if(e[o]=e[o].replace(d.REGEX.gm_GET_NESTING,""),e[o].search(new RegExp(F,"gi"))!==-1)f++;else if(e[o].search(new RegExp(N,"gi"))!==-1)S=!0;else if(e[o].search(new RegExp(I,"gi"))!==-1)f--,S=!0,f<0&&(f=0,S=!1);else if(e[o].search(new RegExp(g,"gi"))!==-1)f++;else if(e[o].search(new RegExp(i,"gi"))!==-1)S=!0;else if(e[o].search(new RegExp(w,"gi"))!==-1)f--,S=!0,f<0&&(f=0,S=!1);else{$.EXCLUDE_KEYWORDS.some(p=>{l=`((?![^{]*})(${p}))`,e[o].search(new RegExp(l,"i"))!==-1&&(E=!0)});let t=!1,m=!1;for(let p of $.NESTINGS){if(E||(l=`((?![^{]*})(\\b${p.keyword})\\b)`,e[o].search(new RegExp(l,"i"))!==-1&&(f++,t=!0)),p.multiline!==""&&(l=`((?![^{]*})(\\b${p.multiline})\\b)`,e[o].search(new RegExp(l,"i"))),p.middle!==""&&(l=`((?![^{]*})(\\b${p.middle})\\b)`,e[o].search(new RegExp(l,"i"))!==-1)){S=!0;break}if(l=`((?![^{]*})(\\b${p.end})\\b)`,e[o].search(new RegExp(l,"i"))!==-1){f--,f<0&&(f=0,S=!1),S=!0;break}t=!1}/\bIF\b/i.test(e[o])&&!/\bTHEN\b/i.test(e[o])?/(AND|OR|NOT)\s*$/i.test(e[o])&&(f++,S=!0):/\bTHEN\b/i.test(e[o])&&S&&f>0&&f--}}if(!R){let E=oe(C,S,n);e[o]=E+e[o],C!==f&&(C=f),S=!1}}for(let o=0;o<e.length;o++)o===e.length-1?e[o]!==""&&(s+=e[o],_&&(s+=d.CRLF)):s+=e[o]+d.CRLF;return s}function oe(r,n,s){let e="";if(r!==0){let l=s.ReplaceTabToSpaces!==!1,f=typeof s.IndentSize=="number"&&s.IndentSize>=1&&s.IndentSize<=10?s.IndentSize:4,C=l?" ".repeat(f):"	";for(let T=0;T<r;T++)n?n=!1:e+=C}return e}function v(r){return r===void 0||r===""||r===`
`||r==="\r"?!0:d.FORMATS.concat(d.SINGLE_OPERATORS,d.DOUBLE_OPERATORS,d.TRENNER).some(n=>r===n)}function re(r,n){let s=z(r,n);s=G(s,n);let e=(n.allowedNumberOfEmptyLines||1)+1;if(n.RemoveEmptyLines){let C;n.EmptyLinesAlsoInComment?C=new RegExp(`(?![^{]*})(^[	]*$\r?
){${e},}`,"gm"):C=new RegExp(`(^[	]*$\r?
){${e},}`,"gm"),s=s.replace(C,d.CRLF)}let l=n.ReplaceTabToSpaces!==!1,f=typeof n.IndentSize=="number"&&n.IndentSize>=1&&n.IndentSize<=10?n.IndentSize:4;if(l){let C=/^\t+/gm;s=s.replace(C,T=>" ".repeat(T.length*f))}return s}});var U=A(B=>{"use strict";Object.defineProperty(B,"__esModule",{value:!0});B.preFormat=le;B.formatNestings=se;B.fullFormatPipeline=ae;var P=D();function le(r,n){return(0,P.preFormat)(r,n)}function se(r,n){return(0,P.formatNestings)(r,n)}function ae(r,n){return(0,P.pureFormatPipeline)(r,n)}});var K=A(a=>{"use strict";Object.defineProperty(a,"__esModule",{value:!0});a.info=a.config=void 0;a.formatTE=ce;a.getConfig=H;a.log=ue;a.cloneArray=Ee;var k=require("vscode"),O=require("vscode"),W=U(),fe=y();a.config={};function ce(r){a.config=H();let n=O.window.activeTextEditor.document,s=ge(r,n,a.config);return[k.TextEdit.replace(r,s)]}function ge(r,n,s){let e,l=n.getText(r);l=(0,W.preFormat)(l,s),l=(0,W.formatNestings)(l,s);let f=(s.allowedNumberOfEmptyLines||1)+1;return s.RemoveEmptyLines&&(s.EmptyLinesAlsoInComment?e=new RegExp(`(?![^{]*})(^[	]*$\r?
){${f},}`,"gm"):e=new RegExp(`(^[	]*$\r?
){${f},}`,"gm"),l=l.replace(e,fe.CRLF)),l}function H(){return a.config.debug=!1,a.config.debugToChannel=!0,a.config.allowedNumberOfEmptyLines=O.workspace.getConfiguration().get("VBI.formatter.EmptyLine.allowedNumberOfEmptyLines"),(a.config.allowedNumberOfEmptyLines<0||a.config.allowedNumberOfEmptyLines>50)&&(a.config.allowedNumberOfEmptyLines=1),a.config.RemoveEmptyLines=O.workspace.getConfiguration().get("VBI.formatter.EmptyLine.RemoveEmptyLines"),a.config.EmptyLinesAlsoInComment=O.workspace.getConfiguration().get("VBI.formatter.EmptyLine.EmptyLinesAlsoInComment"),a.config.BlockCodeBegin=O.workspace.getConfiguration().get("VBI.formatter.BC.BlockCodeBegin"),a.config.BlockCodeEnd=O.workspace.getConfiguration().get("VBI.formatter.BC.BlockCodeEnd"),a.config.BlockCodeExclude=O.workspace.getConfiguration().get("VBI.formatter.BC.BlockCodeExclude"),a.config.RegionBlockCodeBegin=O.workspace.getConfiguration().get("VBI.formatter.Region.BlockCodeBegin"),a.config.RegionBlockCodeEnd=O.workspace.getConfiguration().get("VBI.formatter.Region.BlockCodeEnd"),a.config.RegionBlockCodeExclude=O.workspace.getConfiguration().get("VBI.formatter.Region.BlockCodeExclude"),a.config.ReplaceTabToSpaces=O.workspace.getConfiguration().get("VBI.formatter.Misc.ReplaceTabToSpaces"),a.config.IndentSize=O.workspace.getConfiguration().get("VBI.formatter.Misc.IndentSize"),(typeof a.config.IndentSize!="number"||a.config.IndentSize<1||a.config.IndentSize>10)&&(a.config.IndentSize=4),typeof a.config.ReplaceTabToSpaces!="boolean"&&(a.config.ReplaceTabToSpaces=!0),console.log("getConfig():",a.config),a.config}a.info=k.window.createOutputChannel("VBI-Info");function ue(r,...n){function s(e){switch(typeof e){case"undefined":return"undefined";case"object":let l="";for(let[f,C]of Object.entries(e))l+=`${f}: ${C}
`;return l;default:return e}}if(a.config.debug)if(a.config.debugToChannel)switch(r.toLowerCase()){case"info":n.map(l=>{a.info.appendLine("INFO:"+s(l))}),a.info.show();return;case"warn":n.map(l=>{a.info.appendLine("WARN:"+s(l))}),a.info.show();return;case"error":let e="";n.map(l=>{e+=s(l)}),a.info.appendLine(e),k.window.showErrorMessage(e),a.info.show();return;default:n.map(l=>{a.info.appendLine("INFO-Other:"+s(l))}),a.info.show();return}else switch(r.toLowerCase()){case"info":console.log("INFO:",n);return;case"warn":console.log("WARNING:",n);return;case"error":console.error("ERROR:",n);return;default:console.log("log:",r,n);return}else if(r.toLowerCase()==="error"){let e="";n.map(l=>{e+=s(l)}),console.error("ERROR:",n),k.window.showErrorMessage(e);return}}function Ee(r){return[...r]}});Object.defineProperty(exports,"__esModule",{value:!0});exports.activate=de;exports.deactivate=me;var h=require("vscode"),V=K();function de(r){h.commands.registerCommand("vbi-format",()=>{let{activeTextEditor:n}=h.window;if(n){let{document:s}=n,e=new h.Position(0,0),l=new h.Position(s.lineCount-1,s.lineAt(s.lineCount-1).text.length),f=new h.Range(e,l);return(0,V.formatTE)(f)}}),h.languages.registerDocumentFormattingEditProvider({scheme:"file",language:"intouch"},{provideDocumentFormattingEdits(n){let{activeTextEditor:s}=h.window,e=new h.Position(0,0),l=new h.Position(n.lineCount-1,n.lineAt(n.lineCount-1).text.length),f=new h.Range(e,l);return(0,V.formatTE)(f)}})}function me(){}
//# sourceMappingURL=extension.js.map

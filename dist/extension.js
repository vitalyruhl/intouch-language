"use strict";var F=(o,r)=>()=>(r||o((r={exports:{}}).exports,r),r.exports);var A=F(l=>{"use strict";Object.defineProperty(l,"__esModule",{value:!0});l.REGEX=l.KEYWORDS=l.TRENNER=l.NO_SPACE_ITEMS=l.DOUBLE_OPERATORS=l.SINGLE_OPERATORS=l.FORMATS=l.BACKSLASH=l.SQUOTE=l.DQUOTE=l.CRLF=l.LF=l.CR=l.TAB=void 0;l.TAB="	";l.CR="\r";l.LF=`
`;l.CRLF=`\r
`;l.DQUOTE='"';l.SQUOTE="'";l.BACKSLASH="\\";l.FORMATS=[l.TAB,l.CR,l.LF,l.CRLF,l.DQUOTE,l.SQUOTE,l.BACKSLASH];l.SINGLE_OPERATORS=["=","+","-","<",">","*","/","%","!","~","|"];l.DOUBLE_OPERATORS=["==","<>","<=",">="];l.NO_SPACE_ITEMS=["(",")","[","]",";"];l.TRENNER=[";"," "];l.KEYWORDS=["NULL","EOF","AS","IF","ENDIF","ELSE","WHILE","FOR","next","DIM","THEN","EXIT","EACH","STEP","IN","RETURN","CALL","MOD","AND","NOT","IS","OR","XOR","Abs","TO","SHL","SHR","discrete","integer","real","message","sqr","sin","cos","tan","atn","exp","log","int","frac","round","rnd","sqrt"];var H=new RegExp(/(?![^{]*})\t/,"gm"),V=new RegExp(/\s{1,}/,"gm"),Y=new RegExp(/\s{2,}/,"gm"),j=new RegExp(/\s{2,}(?<!\t)/,"gm"),Q=new RegExp(/(}*{)/,"g"),z=new RegExp(/(})/,"g"),J=new RegExp(/^\s*/,"g"),Z=new RegExp(/(["'])(?:(?=(\\?))\2.)*?\1/,"gm"),ee=new RegExp(/\s+(?=(?:(?:[^"]*"){2})*[^"]*"[^"]*$)/,"gm"),te=new RegExp(/(-?\d*\.\d\w*)|([^\`\~\!\@\#\%\^\&\*\(\)\-\=\+\[\{\]\}\\\|\;\:\'\\"\,\.\<\>\/\?\s]+)/,"gm"),ne=new RegExp(/-?\d*\d/,"gm");l.REGEX={gm_TAB_NOT_IN_COMMENT:H,gm_MOR_1_WSP:V,gm_MOR_2_WSP:Y,g_CHECK_OPEN_COMMENT:Q,g_CHECK_CLOSE_COMMENT:z,gm_GET_NESTING:J,gm_GET_STRING:Z,gm_GET_WSP_IN_STRING:ee,gm_MOR_2_WSP_NO_TAB:j,gm_GET_ALL_WORDS:te,gm_GET_ALL_Numbers:ne}});var D=F(T=>{"use strict";Object.defineProperty(T,"__esModule",{value:!0});T.NESTINGS=T.EXCLUDE_KEYWORDS=void 0;T.EXCLUDE_KEYWORDS=["EXIT FOR"];T.NESTINGS=[{keyword:"if",middle:"else",end:"endif",multiline:"then"},{keyword:"for",middle:"",end:"next",multiline:""},{keyword:"while",middle:"",end:"next",multiline:""}]});var W=F(b=>{"use strict";Object.defineProperty(b,"__esModule",{value:!0});b.formatNestings=oe;b.forFormat=re;var S=A(),f=A(),h=M(),_=D(),B=A();function oe(o,r){let s="",e=[],t="",E=0,u=0,C=!1,g=!1,w=1,y=`^${r.BlockCodeBegin}`,a=`^${r.BlockCodeExclude}`,L=`^${r.BlockCodeEnd}`,N=`^${r.RegionBlockCodeBegin}`,c=`^${r.RegionBlockCodeExclude}`,R=`^${r.RegionBlockCodeEnd}`;try{let x=o.endsWith(S.CRLF);e=o.split(S.CRLF);for(let n=0;n<e.length;n++){w=n+1;let k=!1;e[n]=e[n].replace(/\s+$/g,""),e[n]===""&&(k=!0),e[n].search(B.REGEX.g_CHECK_OPEN_COMMENT)!==-1&&(C=!0),e[n].search(B.REGEX.g_CHECK_CLOSE_COMMENT)!==-1&&(C=!1);let $=e[n].match(B.REGEX.gm_GET_STRING);if($){let P=$.map(m=>{let I=m.replace(/\s(?<!\t)/gim,"\0");return I=I.replace(/\t/gim,"u0001"),e[n].replace(m,I)});e[n]=P[0].replace(B.REGEX.gm_MOR_2_WSP," ");if(!C){for(let m in f.NO_SPACE_ITEMS)r.FormatAlsoInComment?t=`(\\s\\${f.NO_SPACE_ITEMS[m]})`:t=`((?![^{]*})\\s\\${f.NO_SPACE_ITEMS[m]})`,e[n]=e[n].replace(new RegExp(t,"g"),`${f.NO_SPACE_ITEMS[m]}`),r.FormatAlsoInComment?t=`(\\${f.NO_SPACE_ITEMS[m]}\\s)`:t=`((?![^{]*})(\\${f.NO_SPACE_ITEMS[m]}\\s))`,e[n]=e[n].replace(new RegExp(t,"g"),`${f.NO_SPACE_ITEMS[m]}`);r.FormatAlsoInComment?e[n]=e[n].replace(/;(?!\s)/g,"; "):e[n]=e[n].replace(/(?![^{]*});(?!\s)/g,"; "),e[n]=e[n].replace(/\s+;/g,";")}e[n]=e[n].replace(/\0/gim," ").replace(/u0001/gim,"	")}if(!k&&!C){let P=!1;if(e[n]=e[n].replace(B.REGEX.gm_GET_NESTING,""),e[n].search(new RegExp(y,"gi"))!==-1)E++,g=!0;else if(e[n].search(new RegExp(a,"gi"))!==-1)g=!0;else if(e[n].search(new RegExp(L,"gi"))!==-1)E--,g=!0,E<0&&(E=0,g=!1);else if(e[n].search(new RegExp(N,"gi"))!==-1)E++,g=!0;else if(e[n].search(new RegExp(c,"gi"))!==-1)g=!0;else if(e[n].search(new RegExp(R,"gi"))!==-1)E--,g=!0,E<0&&(E=0,g=!1);else{_.EXCLUDE_KEYWORDS.some(I=>{t=`((?![^{]*})(${I}))`,e[n].search(new RegExp(t,"i"))!==-1&&(P=!0)});let m=!1;for(var p=0;p<_.NESTINGS.length;p++){if(P||(t=`((?![^{]*})(\\b${_.NESTINGS[p].keyword})\\b)`,e[n].search(new RegExp(t,"i"))!==-1&&(E++,m=!0)),_.NESTINGS[p].multiline!==""&&(t=`((?![^{]*})(\\b${_.NESTINGS[p].multiline})\\b)`,e[n].search(new RegExp(t,"i"))!==-1&&(m||(g=!0))),_.NESTINGS[p].middle!==""&&(t=`((?![^{]*})(\\b${_.NESTINGS[p].middle})\\b)`,e[n].search(new RegExp(t,"i"))!==-1)){g=!0;break}if(t=`((?![^{]*})(\\b${_.NESTINGS[p].end})\\b)`,e[n].search(new RegExp(t,"i"))!==-1){if(E--,u!==E){g=!0;break}E<0&&(E=0,g=!1)}m=!1}}}k||(u!==E?(e[n]=v(u,g)+e[n],u=E,g=!1):(e[n]=v(u,g)+e[n],g=!1))}for(let n=0;n<e.length;n++)n===e.length-1?e[n]!==""&&(s+=e[n],x&&(s+=S.CRLF)):s+=e[n]+S.CRLF}catch{return(0,h.log)("Error",`Unhandled Error @ Line ${w}!`),o}return s}function v(o,r){let s="";if(o!==0)for(let e=0;e<o;e++)r?r=!1:s+=S.TAB;return s}function re(o,r){let s=o.split(""),e="",t=0,E=0,u=!1,C=!1,g=1,w=0;for(t=0;t<=s.length-1;t++)if(w++,E>0)E--;else{if(E=0,C&&s[t]==='"'?C=!1:u||s[t]==='"'&&(C=!0),s[t]===S.LF){if(C)return(0,h.log)("Error",`Error @ Line ${g} at Column ${w} -> no closed string detected!`),(0,h.log)("info",e),o;g++,w=0}if(!u&&s[t]==="}")return(0,h.log)("Error",`Error @ Line ${g} at Column ${w} -> closed comment bracket witout Open comment bracket!`),(0,h.log)("Error",e),o;if(s[t]==="{"?u=!0:u&&s[t]==="}"&&(u=!1),!C&&!(E>0)&&(!u||r.KeywordUppercaseAlsoInComment)){let a,L="",N="";for(a in f.KEYWORDS){let c,R="";for(L=o[t-1],c=0;c<=f.KEYWORDS[a].length-1;c++)R+=o[t+c],N=o[t+c+1];R.toLowerCase()===f.KEYWORDS[a].toLowerCase()&&U(L)&&U(N)&&(R=f.KEYWORDS[a].toUpperCase()+N,e+=R,E=R.length-1)}if(!(E>0))for(a in f.DOUBLE_OPERATORS){let c,R="";for(L=o[t-1],c=0;c<=f.DOUBLE_OPERATORS[a].length-1;c++)R+=o[t+c],N=o[t+c+1];if(R===f.DOUBLE_OPERATORS[a]){o[t-1]!==" "&&(e+=" "),e+=f.DOUBLE_OPERATORS[a],o[t+2]!==" "&&(e+=" "),E=1;break}}if(!(E>0)){for(a in f.SINGLE_OPERATORS)if(o[t]===f.SINGLE_OPERATORS[a]){if(f.SINGLE_OPERATORS[a]==="-"){let c=o[t+1]==" "&&o[t-1]!=" ",R=o[t+1]==" "&&o[t-1]!=" "&&isNaN(+o[t+1]);c&&(e+=" ")}else o[t-1]!=" "&&(e+=" ");e+=o[t],o[t+1]!=" "&&(f.SINGLE_OPERATORS[a]==="-"||(f.SINGLE_OPERATORS[a]==="+"?isNaN(+o[t+1])&&(e+=" "):e+=" ")),E=-1;break}}}E===0&&(e+=s[t])}return e.replace(/\s+;/g,";").split(S.CRLF).map(a=>a.replace(/\s+$/g,"")).join(S.CRLF)}function U(o){return f.FORMATS.concat(f.SINGLE_OPERATORS,f.DOUBLE_OPERATORS,f.TRENNER).some(r=>o===r)}});var M=F(i=>{"use strict";Object.defineProperty(i,"__esModule",{value:!0});i.info=i.config=void 0;i.formatTE=le;i.getConfig=q;i.log=Ee;i.cloneArray=fe;var G=require("vscode"),d=require("vscode"),K=W(),ie=A();i.config={};function le(o){i.config=q();let r=d.window.activeTextEditor.document,s=se(o,r,i.config);return[G.TextEdit.replace(o,s)]}function se(o,r,s){let e,t=r.getText(o);t=(0,K.forFormat)(t,s),t=(0,K.formatNestings)(t,s);let E=(s.allowedNumberOfEmptyLines||1)+1;return s.RemoveEmptyLines&&(s.EmptyLinesAlsoInComment?e=new RegExp(`(?![^{]*})(^[	]*$\r?
){${E},}`,"gm"):e=new RegExp(`(^[	]*$\r?
){${E},}`,"gm"),t=t.replace(e,ie.CRLF)),t}function q(){return i.config.debug=!1,i.config.debugToChannel=!0,i.config.allowedNumberOfEmptyLines=d.workspace.getConfiguration().get("VBI.formatter.EmptyLine.allowedNumberOfEmptyLines"),(i.config.allowedNumberOfEmptyLines<0||i.config.allowedNumberOfEmptyLines>50)&&(i.config.allowedNumberOfEmptyLines=1),i.config.RemoveEmptyLines=d.workspace.getConfiguration().get("VBI.formatter.EmptyLine.RemoveEmptyLines"),i.config.EmptyLinesAlsoInComment=d.workspace.getConfiguration().get("VBI.formatter.EmptyLine.EmptyLinesAlsoInComment"),i.config.BlockCodeBegin=d.workspace.getConfiguration().get("VBI.formatter.BC.BlockCodeBegin"),i.config.BlockCodeEnd=d.workspace.getConfiguration().get("VBI.formatter.BC.BlockCodeEnd"),i.config.BlockCodeExclude=d.workspace.getConfiguration().get("VBI.formatter.BC.BlockCodeExclude"),i.config.RegionBlockCodeBegin=d.workspace.getConfiguration().get("VBI.formatter.Region.BlockCodeBegin"),i.config.RegionBlockCodeEnd=d.workspace.getConfiguration().get("VBI.formatter.Region.BlockCodeEnd"),i.config.RegionBlockCodeExclude=d.workspace.getConfiguration().get("VBI.formatter.Region.BlockCodeExclude"),i.config.FormatAlsoInComment=d.workspace.getConfiguration().get("VBI.formatter.FormatAlsoInComment"),console.log("getConfig():",i.config),i.config}i.info=G.window.createOutputChannel("VBI-Info");function Ee(o,...r){function s(e){switch(typeof e){case"undefined":return"undefined";case"object":let t="";for(let[E,u]of Object.entries(e))t+=`${E}: ${u}
`;return t;default:return e}}if(i.config.debug)if(i.config.debugToChannel)switch(o.toLowerCase()){case"info":r.map(t=>{i.info.appendLine("INFO:"+s(t))}),i.info.show();return;case"warn":r.map(t=>{i.info.appendLine("WARN:"+s(t))}),i.info.show();return;case"error":let e="";r.map(t=>{e+=s(t)}),i.info.appendLine(e),G.window.showErrorMessage(e),i.info.show();return;default:r.map(t=>{i.info.appendLine("INFO-Other:"+s(t))}),i.info.show();return}else switch(o.toLowerCase()){case"info":console.log("INFO:",r);return;case"warn":console.log("WARNING:",r);return;case"error":console.error("ERROR:",r);return;default:console.log("log:",o,r);return}else if(o.toLowerCase()==="error"){let e="";r.map(t=>{e+=s(t)}),console.error("ERROR:",r),G.window.showErrorMessage(e);return}}function fe(o){return[...o]}});Object.defineProperty(exports,"__esModule",{value:!0});exports.activate=ge;exports.deactivate=ae;var O=require("vscode"),X=M();function ge(o){O.commands.registerCommand("vbi-format",()=>{let{activeTextEditor:r}=O.window;if(r){let{document:s}=r,e=new O.Position(0,0),t=new O.Position(s.lineCount-1,s.lineAt(s.lineCount-1).text.length),E=new O.Range(e,t);return(0,X.formatTE)(E)}}),O.languages.registerDocumentFormattingEditProvider({scheme:"file",language:"intouch"},{provideDocumentFormattingEdits(r){let{activeTextEditor:s}=O.window,e=new O.Position(0,0),t=new O.Position(r.lineCount-1,r.lineAt(r.lineCount-1).text.length),E=new O.Range(e,t);return(0,X.formatTE)(E)}})}function ae(){}
//!-----------------------------------------------------------------------------------
//! NEW formatting's
//! it might be replaced in strings to?! -> its a Problem? -> fix them so far as possible
//! END New formatting's
//# sourceMappingURL=extension.js.map

"use strict";var I=(l,r)=>()=>(r||l((r={exports:{}}).exports,r),r.exports);var P=I(a=>{"use strict";Object.defineProperty(a,"__esModule",{value:!0});a.REGEX=a.KEYWORDS=a.TRENNER=a.NO_SPACE_ITEMS=a.DOUBLE_OPERATORS=a.SINGLE_OPERATORS=a.FORMATS=a.BACKSLASH=a.SQUOTE=a.DQUOTE=a.CRLF=a.LF=a.CR=a.TAB=void 0;a.TAB="	";a.CR="\r";a.LF=`
`;a.CRLF=`\r
`;a.DQUOTE='"';a.SQUOTE="'";a.BACKSLASH="\\";a.FORMATS=[a.TAB,a.CR,a.LF,a.CRLF,a.DQUOTE,a.SQUOTE,a.BACKSLASH];a.SINGLE_OPERATORS=["=","+","-","<",">","*","/","%","!","~","|"];a.DOUBLE_OPERATORS=["==","<>","<=",">="];a.NO_SPACE_ITEMS=["(",")","[","]",";"];a.TRENNER=[";"," "];a.KEYWORDS=["NULL","EOF","AS","IF","ENDIF","ELSE","WHILE","FOR","next","DIM","THEN","EXIT","EACH","STEP","IN","RETURN","CALL","MOD","AND","NOT","IS","OR","XOR","Abs","TO","SHL","SHR","discrete","integer","real","message","sqr","sin","cos","tan","atn","exp","log","int","frac","round","rnd","sqrt"];var X=new RegExp(/(?![^{]*})\t/,"gm"),j=new RegExp(/\s{1,}/,"gm"),Z=new RegExp(/\s{2,}/,"gm"),q=new RegExp(/\s{2,}(?<!\t)/,"gm"),Q=new RegExp(/(}*{)/,"g"),Y=new RegExp(/(})/,"g"),J=new RegExp(/^\s*/,"g"),ee=new RegExp(/(["'])(?:(?=(\\?))\2.)*?\1/,"gm"),te=new RegExp(/\s+(?=(?:(?:[^"]*"){2})*[^"]*"[^"]*$)/,"gm"),ne=new RegExp(/(-?\d*\.\d\w*)|([^\`\~\!\@\#\%\^\&\*\(\)\-\=\+\[\{\]\}\\\|\;\:\'\\"\,\.\<\>\/\?\s]+)/,"gm"),ie=new RegExp(/-?\d*\d/,"gm");a.REGEX={gm_TAB_NOT_IN_COMMENT:X,gm_MOR_1_WSP:j,gm_MOR_2_WSP:Z,g_CHECK_OPEN_COMMENT:Q,g_CHECK_CLOSE_COMMENT:Y,gm_GET_NESTING:J,gm_GET_STRING:ee,gm_GET_WSP_IN_STRING:te,gm_MOR_2_WSP_NO_TAB:q,gm_GET_ALL_WORDS:ne,gm_GET_ALL_Numbers:ie}});var $=I(S=>{"use strict";Object.defineProperty(S,"__esModule",{value:!0});S.NESTINGS=S.EXCLUDE_KEYWORDS=void 0;S.EXCLUDE_KEYWORDS=["EXIT FOR"];S.NESTINGS=[{keyword:"if",middle:"else",end:"endif",multiline:"then"},{keyword:"for",middle:"",end:"next",multiline:""},{keyword:"while",middle:"",end:"next",multiline:""}]});var U=I(B=>{"use strict";Object.defineProperty(B,"__esModule",{value:!0});B.preFormat=G;B.formatNestings=D;B.pureFormatPipeline=re;var d=P(),M=$();function G(l,r){l=l.replace(/\r\n|\n|\r/g,`\r
`);let s=l.split(""),e="",i=0,E=!1,h=!1,T=1,C=0;for(let n=0;n<=s.length-1;n++)if(C++,i>0)i--;else{if(i=0,h&&s[n]==='"'?h=!1:!E&&s[n]==='"'&&(h=!0),s[n]===`
`){if(h)return l;T++,C=0}if(!E&&s[n]==="}")return l;if(s[n]==="{"?E=!0:E&&s[n]==="}"&&(E=!1),!h&&!(i>0)&&(!E||r.KeywordUppercaseAlsoInComment)){for(let R of d.KEYWORDS){let w=l.substr(n,R.length),o=l[n-1],p=l[n+R.length];if(w.toLowerCase()===R.toLowerCase()&&v(o)&&v(p)){e+=R.toUpperCase(),i=R.length-1;break}}if(!(i>0)){for(let R of d.DOUBLE_OPERATORS)if(l.substr(n,R.length)===R){l[n-1]!==" "&&(e+=" "),e+=R,l[n+R.length]!==" "&&(e+=" "),i=R.length-1;break}}if(!(i>0)){let R=p=>/[A-Za-z0-9_$]/.test(p||""),w=p=>/[A-Za-z]/.test(p||""),o=p=>/[A-Za-z0-9$-]/.test(p||"");for(let p of d.SINGLE_OPERATORS){if(s[n]!==p)continue;if(p==="-"){let t=l[n-1],u=l[n+1];if(o(t)&&o(u)){let _=n-1;for(;_>=0&&o(l[_]);)_--;_++;let x=n+1;for(;x<l.length&&o(l[x]);)x++;let pe=l.slice(_,x);if(w(l[_])){e+="-",i=-1;break}}}let g=!1;if(p==="-"){let t=e.length-1;for(;t>=0&&/[ \t]/.test(e[t]);)t--;let u=t>=0?e[t]:void 0,_=l[n+1];(u===void 0||/[=+\-*/,(;{}]/.test(u)||u===`
`||u==="\r")&&/[0-9]/.test(_)&&(g=!0)}let m=!(p==="-"&&g);if(m&&e.length>0&&!/[ \t\r\n]/.test(e[e.length-1])&&(e+=" "),e+=p,m){let t=l[n+1];t&&!/[ \t\r\n]/.test(t)&&(e+=" ")}i=-1;break}}}i===0&&(e+=s[n])}e=e.replace(/\r\r\n/g,d.CRLF).replace(/\r(?!\n)/g,"");let b=e.split(d.CRLF).map(n=>n.replace(/\s+$/g,"")),N=[],A=0;for(let n of b)if(n===""){A++,A===1&&N.push("");continue}else A=0,N.push(n);let c=N.join(d.CRLF);return c=(()=>{let n="",R=!1,w=!1,o=0,p=g=>/[A-Za-z]/.test(g);for(let g=0;g<c.length;g++){let m=c[g];if(m==='"'){R=!R,n+=m;continue}if(!R){if(m==="{"){w=!0,n+=m;continue}if(m==="}"&&w&&(w=!1),!w&&(m==="i"||m==="I")&&(c[g+1]==="f"||c[g+1]==="F")){let t=g+2;for(;t<c.length&&c[t]===" ";)t++;if(c[t]==="("){n+="IF (";let u=t+1;for(;u<c.length&&c[u]===" ";)u++;o=1,g=u-1;continue}}if(!w&&m===")"){if(o>0){for(;n.length>0&&n[n.length-1]===" ";)n=n.slice(0,-1);o=0}n+=")";let t=g+1;for(;t<c.length&&c[t]===" ";)t++;if(c.slice(t,t+4).toLowerCase()==="then"){n+=" THEN",g=t+3;continue}let _=c[g+1];_&&p(_)&&(n+=" ");continue}if(!w&&(m==="T"||m==="t")&&c.slice(g,g+4).toLowerCase()==="then"){let t=g+4;for(;t<c.length&&c[t]===" ";)t++;if(c[t]==="{"){n+="THEN ",g=g+3;continue}}if(!w&&m===";"){let t=c[g+1];if(t&&t!==" "&&t!=="\r"&&t!==`
`){n+="; ";continue}}if(m==="}"){let t=g+1;for(;t<c.length&&c[t]===" ";)t++;if(t<c.length&&p(c[t])&&c[g+1]!==" "){n+="} ";continue}}if(!w&&/[A-Za-z0-9_]/.test(m)&&c[g+1]===" "&&c[g+2]==="-"&&/[A-Za-z_]/.test(c[g+3])){let t=n.length-1;for(;t>=0&&/[A-Za-z0-9$-]/.test(n[t]);)t--;let u=g+3;for(;u<c.length&&/[A-Za-z0-9$-]/.test(c[u]);)u++;let _=n.slice(t+1)+c.slice(g,u);if(!/^[A-Za-z][A-Za-z0-9$-]*-[A-Za-z0-9$-]*-[A-Za-z0-9$-]*$/.test(_)){n+=m+" - "+c[g+3],g+=3;continue}}if(!w&&m===","){for(;n.length>0&&n[n.length-1]===" ";)n=n.slice(0,-1);n+=",";let t=c[g+1];t&&t!==" "&&t!==")"&&t!=="\r"&&t!==`
`&&(n+=" ");continue}}n+=m}return n.replace(/= {2,}>/g,"= >")})(),c}function D(l,r){let s="",e=[],i="",E=0,h=0,T=!1,C=!1,b=`^${r.BlockCodeBegin}`,N=`^${r.BlockCodeExclude}`,A=`^${r.BlockCodeEnd}`,c=`^${r.RegionBlockCodeBegin}`,n=`^${r.RegionBlockCodeExclude}`,R=`^${r.RegionBlockCodeEnd}`,w=l.endsWith(d.CRLF);e=l.split(d.CRLF);for(let o=0;o<e.length;o++){let p=!1;e[o]=e[o].replace(/\s+$/g,""),e[o]===""&&(p=!0),e[o].search(d.REGEX.g_CHECK_OPEN_COMMENT)!==-1&&(T=!0),e[o].search(d.REGEX.g_CHECK_CLOSE_COMMENT)!==-1&&(T=!1);let g=e[o].match(d.REGEX.gm_GET_STRING);if(g){let m=e[o];for(let t of g){let u=t.replace(/\s(?<!\t)/gim,"\0");u=u.replace(/\t/gim,"u0001"),u=u.replace(/;/g,"u0002"),m=m.replace(t,u)}if(e[o]=m.replace(d.REGEX.gm_MOR_2_WSP," "),!T){for(let t in d.NO_SPACE_ITEMS)i=`((?![^{]*})\\s\\${d.NO_SPACE_ITEMS[t]})`,e[o]=e[o].replace(new RegExp(i,"g"),`${d.NO_SPACE_ITEMS[t]}`),i=`((?![^{]*})(\\${d.NO_SPACE_ITEMS[t]}\\s))`,e[o]=e[o].replace(new RegExp(i,"g"),`${d.NO_SPACE_ITEMS[t]}`);e[o]=e[o].replace(/(?![^{]*});(?!\s)/g,"; "),e[o]=e[o].replace(/\s+;/g,";")}e[o]=e[o].replace(/\0/gim," ").replace(/u0001/gim,"	").replace(/u0002/gim,";")}if(!p&&!T){let m=!1;if(e[o]=e[o].replace(d.REGEX.gm_GET_NESTING,""),e[o].search(new RegExp(b,"gi"))!==-1)E++,C=!0;else if(e[o].search(new RegExp(N,"gi"))!==-1)C=!0;else if(e[o].search(new RegExp(A,"gi"))!==-1)E--,C=!0,E<0&&(E=0,C=!1);else if(e[o].search(new RegExp(c,"gi"))!==-1)E++,C=!0;else if(e[o].search(new RegExp(n,"gi"))!==-1)C=!0;else if(e[o].search(new RegExp(R,"gi"))!==-1)E--,C=!0,E<0&&(E=0,C=!1);else{M.EXCLUDE_KEYWORDS.some(u=>{i=`((?![^{]*})(${u}))`,e[o].search(new RegExp(i,"i"))!==-1&&(m=!0)});let t=!1;for(let u of M.NESTINGS){if(m||(i=`((?![^{]*})(\\b${u.keyword})\\b)`,e[o].search(new RegExp(i,"i"))!==-1&&(E++,t=!0)),u.multiline!==""&&(i=`((?![^{]*})(\\b${u.multiline})\\b)`,e[o].search(new RegExp(i,"i"))),u.middle!==""&&(i=`((?![^{]*})(\\b${u.middle})\\b)`,e[o].search(new RegExp(i,"i"))!==-1)){C=!0;break}if(i=`((?![^{]*})(\\b${u.end})\\b)`,e[o].search(new RegExp(i,"i"))!==-1){E--,E<0&&(E=0,C=!1),C=!0;break}t=!1}}}if(!p){let m=oe(h,C);e[o]=m+e[o],h!==E&&(h=E),C=!1}}for(let o=0;o<e.length;o++)o===e.length-1?e[o]!==""&&(s+=e[o],w&&(s+=d.CRLF)):s+=e[o]+d.CRLF;return s}function oe(l,r){let s="";if(l!==0)for(let e=0;e<l;e++)r?r=!1:s+=d.TAB;return s}function v(l){return d.FORMATS.concat(d.SINGLE_OPERATORS,d.DOUBLE_OPERATORS,d.TRENNER).some(r=>l===r)}function re(l,r){let s=G(l,r);s=D(s,r);let e=(r.allowedNumberOfEmptyLines||1)+1;if(r.RemoveEmptyLines){let i;r.EmptyLinesAlsoInComment?i=new RegExp(`(?![^{]*})(^[	]*$\r?
){${e},}`,"gm"):i=new RegExp(`(^[	]*$\r?
){${e},}`,"gm"),s=s.replace(i,d.CRLF)}return s}});var W=I(F=>{"use strict";Object.defineProperty(F,"__esModule",{value:!0});F.preFormat=le;F.formatNestings=se;F.fullFormatPipeline=fe;var y=U();function le(l,r){return(0,y.preFormat)(l,r)}function se(l,r){return(0,y.formatNestings)(l,r)}function fe(l,r){return(0,y.pureFormatPipeline)(l,r)}});var z=I(f=>{"use strict";Object.defineProperty(f,"__esModule",{value:!0});f.info=f.config=void 0;f.formatTE=ce;f.getConfig=K;f.log=ue;f.cloneArray=Ee;var k=require("vscode"),O=require("vscode"),H=W(),ae=P();f.config={};function ce(l){f.config=K();let r=O.window.activeTextEditor.document,s=ge(l,r,f.config);return[k.TextEdit.replace(l,s)]}function ge(l,r,s){let e,i=r.getText(l);i=(0,H.preFormat)(i,s),i=(0,H.formatNestings)(i,s);let E=(s.allowedNumberOfEmptyLines||1)+1;return s.RemoveEmptyLines&&(s.EmptyLinesAlsoInComment?e=new RegExp(`(?![^{]*})(^[	]*$\r?
){${E},}`,"gm"):e=new RegExp(`(^[	]*$\r?
){${E},}`,"gm"),i=i.replace(e,ae.CRLF)),i}function K(){return f.config.debug=!1,f.config.debugToChannel=!0,f.config.allowedNumberOfEmptyLines=O.workspace.getConfiguration().get("VBI.formatter.EmptyLine.allowedNumberOfEmptyLines"),(f.config.allowedNumberOfEmptyLines<0||f.config.allowedNumberOfEmptyLines>50)&&(f.config.allowedNumberOfEmptyLines=1),f.config.RemoveEmptyLines=O.workspace.getConfiguration().get("VBI.formatter.EmptyLine.RemoveEmptyLines"),f.config.EmptyLinesAlsoInComment=O.workspace.getConfiguration().get("VBI.formatter.EmptyLine.EmptyLinesAlsoInComment"),f.config.BlockCodeBegin=O.workspace.getConfiguration().get("VBI.formatter.BC.BlockCodeBegin"),f.config.BlockCodeEnd=O.workspace.getConfiguration().get("VBI.formatter.BC.BlockCodeEnd"),f.config.BlockCodeExclude=O.workspace.getConfiguration().get("VBI.formatter.BC.BlockCodeExclude"),f.config.RegionBlockCodeBegin=O.workspace.getConfiguration().get("VBI.formatter.Region.BlockCodeBegin"),f.config.RegionBlockCodeEnd=O.workspace.getConfiguration().get("VBI.formatter.Region.BlockCodeEnd"),f.config.RegionBlockCodeExclude=O.workspace.getConfiguration().get("VBI.formatter.Region.BlockCodeExclude"),f.config.FormatAlsoInComment=O.workspace.getConfiguration().get("VBI.formatter.FormatAlsoInComment"),console.log("getConfig():",f.config),f.config}f.info=k.window.createOutputChannel("VBI-Info");function ue(l,...r){function s(e){switch(typeof e){case"undefined":return"undefined";case"object":let i="";for(let[E,h]of Object.entries(e))i+=`${E}: ${h}
`;return i;default:return e}}if(f.config.debug)if(f.config.debugToChannel)switch(l.toLowerCase()){case"info":r.map(i=>{f.info.appendLine("INFO:"+s(i))}),f.info.show();return;case"warn":r.map(i=>{f.info.appendLine("WARN:"+s(i))}),f.info.show();return;case"error":let e="";r.map(i=>{e+=s(i)}),f.info.appendLine(e),k.window.showErrorMessage(e),f.info.show();return;default:r.map(i=>{f.info.appendLine("INFO-Other:"+s(i))}),f.info.show();return}else switch(l.toLowerCase()){case"info":console.log("INFO:",r);return;case"warn":console.log("WARNING:",r);return;case"error":console.error("ERROR:",r);return;default:console.log("log:",l,r);return}else if(l.toLowerCase()==="error"){let e="";r.map(i=>{e+=s(i)}),console.error("ERROR:",r),k.window.showErrorMessage(e);return}}function Ee(l){return[...l]}});Object.defineProperty(exports,"__esModule",{value:!0});exports.activate=me;exports.deactivate=de;var L=require("vscode"),V=z();function me(l){L.commands.registerCommand("vbi-format",()=>{let{activeTextEditor:r}=L.window;if(r){let{document:s}=r,e=new L.Position(0,0),i=new L.Position(s.lineCount-1,s.lineAt(s.lineCount-1).text.length),E=new L.Range(e,i);return(0,V.formatTE)(E)}}),L.languages.registerDocumentFormattingEditProvider({scheme:"file",language:"intouch"},{provideDocumentFormattingEdits(r){let{activeTextEditor:s}=L.window,e=new L.Position(0,0),i=new L.Position(r.lineCount-1,r.lineAt(r.lineCount-1).text.length),E=new L.Range(e,i);return(0,V.formatTE)(E)}})}function de(){}
//# sourceMappingURL=extension.js.map

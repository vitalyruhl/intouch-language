"use strict";var F=(o,n)=>()=>(n||o((n={exports:{}}).exports,n),n.exports);var P=F(f=>{"use strict";Object.defineProperty(f,"__esModule",{value:!0});f.REGEX=f.KEYWORDS=f.TRENNER=f.NO_SPACE_ITEMS=f.DOUBLE_OPERATORS=f.SINGLE_OPERATORS=f.FORMATS=f.BACKSLASH=f.SQUOTE=f.DQUOTE=f.CRLF=f.LF=f.CR=f.TAB=void 0;f.TAB="	";f.CR="\r";f.LF=`
`;f.CRLF=`\r
`;f.DQUOTE='"';f.SQUOTE="'";f.BACKSLASH="\\";f.FORMATS=[f.TAB,f.CR,f.LF,f.CRLF,f.DQUOTE,f.SQUOTE,f.BACKSLASH];f.SINGLE_OPERATORS=["=","+","-","<",">","*","/","%","!","~","|"];f.DOUBLE_OPERATORS=["==","<>","<=",">="];f.NO_SPACE_ITEMS=["(",")","[","]",";"];f.TRENNER=[";"," "];f.KEYWORDS=["NULL","EOF","AS","IF","ENDIF","ELSE","WHILE","FOR","next","DIM","THEN","EXIT","EACH","STEP","IN","RETURN","CALL","MOD","AND","NOT","IS","OR","XOR","Abs","TO","SHL","SHR","discrete","integer","real","message","sqr","sin","cos","tan","atn","exp","log","int","frac","round","rnd","sqrt"];var Y=new RegExp(/(?![^{]*})\t/,"gm"),J=new RegExp(/\s{1,}/,"gm"),ee=new RegExp(/\s{2,}/,"gm"),te=new RegExp(/\s{2,}(?<!\t)/,"gm"),ne=new RegExp(/(}*{)/,"g"),ie=new RegExp(/(})/,"g"),oe=new RegExp(/^\s*/,"g"),re=new RegExp(/(["'])(?:(?=(\\?))\2.)*?\1/,"gm"),se=new RegExp(/\s+(?=(?:(?:[^"]*"){2})*[^"]*"[^"]*$)/,"gm"),le=new RegExp(/(-?\d*\.\d\w*)|([^\`\~\!\@\#\%\^\&\*\(\)\-\=\+\[\{\]\}\\\|\;\:\'\\"\,\.\<\>\/\?\s]+)/,"gm"),ae=new RegExp(/-?\d*\d/,"gm");f.REGEX={gm_TAB_NOT_IN_COMMENT:Y,gm_MOR_1_WSP:J,gm_MOR_2_WSP:ee,g_CHECK_OPEN_COMMENT:ne,g_CHECK_CLOSE_COMMENT:ie,gm_GET_NESTING:oe,gm_GET_STRING:re,gm_GET_WSP_IN_STRING:se,gm_MOR_2_WSP_NO_TAB:te,gm_GET_ALL_WORDS:le,gm_GET_ALL_Numbers:ae}});var z=F(A=>{"use strict";Object.defineProperty(A,"__esModule",{value:!0});A.NESTINGS=A.EXCLUDE_KEYWORDS=void 0;A.EXCLUDE_KEYWORDS=["EXIT FOR"];A.NESTINGS=[{keyword:"if",middle:"else",end:"endif",multiline:"then"},{keyword:"for",middle:"",end:"next",multiline:""},{keyword:"while",middle:"",end:"next",multiline:""}]});var W=F(x=>{"use strict";Object.defineProperty(x,"__esModule",{value:!0});x.preFormat=H;x.formatNestings=U;x.pureFormatPipeline=ce;var m=P(),D=z();function H(o,n){o=o.replace(/\r\n|\n|\r/g,`\r
`);let l=o.split(""),e="",r=0,c=!1,d=!1,O=1,S=0;for(let i=0;i<=l.length-1;i++)if(S++,r>0)r--;else{if(r=0,d&&l[i]==='"'?d=!1:!c&&l[i]==='"'&&(d=!0),l[i]===`
`){if(d)return o;O++,S=0}if(!c&&l[i]==="}")return o;if(l[i]==="{"?c=!0:c&&l[i]==="}"&&(c=!1),!d&&!(r>0)&&(!c||n.KeywordUppercaseAlsoInComment)){for(let R of m.KEYWORDS){let w=o.substr(i,R.length),_=o[i-1],C=o[i+R.length];if(w.toLowerCase()===R.toLowerCase()&&G(_)&&G(C)){e+=R.toUpperCase(),r=R.length-1;break}}if(!(r>0)){for(let R of m.DOUBLE_OPERATORS)if(o.substr(i,R.length)===R){o[i-1]!==" "&&(e+=" "),e+=R,o[i+R.length]!==" "&&(e+=" "),r=R.length-1;break}}if(!(r>0)){let R=C=>/[A-Za-z0-9_$]/.test(C||""),w=C=>/[A-Za-z]/.test(C||""),_=C=>/[A-Za-z0-9$-]/.test(C||"");for(let C of m.SINGLE_OPERATORS){if(l[i]!==C)continue;if(C==="-"){let s=o[i-1],u=o[i+1];if(_(s)&&_(u)){let E=i-1;for(;E>=0&&_(o[E]);)E--;E++;let h=i+1;for(;h<o.length&&_(o[h]);)h++;let $=o.slice(E,h);if(w(o[E])){e+="-",r=-1;break}}}let t=!1;if(C==="-"){let s=e.length-1;for(;s>=0&&/[ \t]/.test(e[s]);)s--;let u=s>=0?e[s]:void 0,E=o[i+1];(u===void 0||/[=+\-*/,(;{}]/.test(u)||u===`
`||u==="\r")&&/[0-9]/.test(E)&&(t=!0)}let p=!(C==="-"&&t);if(p&&e.length>0&&!/[ \t\r\n]/.test(e[e.length-1])&&(e+=" "),e+=C,p){let s=o[i+1];s&&!/[ \t\r\n]/.test(s)&&(e+=" ")}r=-1;break}}}r===0&&(e+=l[i])}e=e.replace(/\r\r\n/g,m.CRLF).replace(/\r(?!\n)/g,"");let b=e.split(m.CRLF).map(i=>i.replace(/\s+$/g,"")),I=[],B=0;for(let i of b)if(i===""){B++,B===1&&I.push("");continue}else B=0,I.push(i);let g=I.join(m.CRLF);return g=(()=>{let i="",R=!1,w=!1,_=0,C=t=>/[A-Za-z]/.test(t);for(let t=0;t<g.length;t++){let p=g[t];if(p==='"'){R=!R,i+=p;continue}if(!R){if(p==="{"){w=!0,i+=p;continue}if(p==="}"&&w&&(w=!1),!w&&(p==="i"||p==="I")&&(g[t+1]==="f"||g[t+1]==="F")){let s=t+2;for(;s<g.length&&g[s]===" ";)s++;if(g[s]==="("){i+="IF (";let u=s+1;for(;u<g.length&&g[u]===" ";)u++;_=1,t=u-1;continue}}if(!w&&p===")"){if(_>0){for(;i.length>0&&i[i.length-1]===" ";)i=i.slice(0,-1);_=0}i+=")";let s=t+1;for(;s<g.length&&g[s]===" ";)s++;if(g.slice(s,s+4).toLowerCase()==="then"){i+=" THEN",t=s+3;continue}let E=g[t+1];E&&C(E)&&(i+=" ");continue}if(!w&&(p==="T"||p==="t")&&g.slice(t,t+4).toLowerCase()==="then"){let s=t+4;for(;s<g.length&&g[s]===" ";)s++;if(g[s]==="{"){i+="THEN ",t=t+3;continue}}if(!w&&p===";"){let s=g[t+1];if(s&&s!==" "&&s!=="\r"&&s!==`
`){i+="; ";continue}}if(p==="}"){let s=t+1;for(;s<g.length&&g[s]===" ";)s++;if(s<g.length&&C(g[s])&&g[t+1]!==" "){i+="} ";continue}}if(!w&&/[A-Za-z0-9_]/.test(p)&&g[t+1]===" "&&g[t+2]==="-"&&/[A-Za-z_]/.test(g[t+3])){let s=i.length-1;for(;s>=0&&/[A-Za-z0-9$-]/.test(i[s]);)s--;let u=t+3;for(;u<g.length&&/[A-Za-z0-9$-]/.test(g[u]);)u++;let E=i.slice(s+1)+g.slice(t,u);if(!/^[A-Za-z][A-Za-z0-9$-]*-[A-Za-z0-9$-]*-[A-Za-z0-9$-]*$/.test(E)){i+=p+" - "+g[t+3],t+=3;continue}}if(!w&&p===","){for(;i.length>0&&i[i.length-1]===" ";)i=i.slice(0,-1);i+=",";let s=g[t+1];s&&s!==" "&&s!==")"&&s!=="\r"&&s!==`
`&&(i+=" ");continue}}i+=p}return i.replace(/= {2,}>/g,"= >")})(),g}function U(o,n){let l="",e=[],r="",c=0,d=0,O=!1,S=!1,b=!1,I=0,B=`^${n.BlockCodeBegin}`,g=`^${n.BlockCodeExclude}`,i=`^${n.BlockCodeEnd}`,R=`^${n.RegionBlockCodeBegin}`,w=`^${n.RegionBlockCodeExclude}`,_=`^${n.RegionBlockCodeEnd}`,C=o.endsWith(m.CRLF);e=o.split(m.CRLF);for(let t=0;t<e.length;t++){let p=!1;e[t]=e[t].replace(/\s+$/g,""),e[t]===""&&(p=!0),e[t].search(m.REGEX.g_CHECK_OPEN_COMMENT)!==-1&&(O=!0),e[t].search(m.REGEX.g_CHECK_CLOSE_COMMENT)!==-1&&(O=!1);let s=e[t].match(m.REGEX.gm_GET_STRING);if(s){let u=e[t];for(let E of s){let h=E.replace(/\s(?<!\t)/gim,"\0");h=h.replace(/\t/gim,"u0001"),h=h.replace(/;/g,"u0002"),u=u.replace(E,h)}if(e[t]=u.replace(m.REGEX.gm_MOR_2_WSP," "),!O){for(let E in m.NO_SPACE_ITEMS)r=`((?![^{]*})\\s\\${m.NO_SPACE_ITEMS[E]})`,e[t]=e[t].replace(new RegExp(r,"g"),`${m.NO_SPACE_ITEMS[E]}`),r=`((?![^{]*})(\\${m.NO_SPACE_ITEMS[E]}\\s))`,e[t]=e[t].replace(new RegExp(r,"g"),`${m.NO_SPACE_ITEMS[E]}`);e[t]=e[t].replace(/(?![^{]*});(?!\s)/g,"; "),e[t]=e[t].replace(/\s+;/g,";")}e[t]=e[t].replace(/\0/gim," ").replace(/u0001/gim,"	").replace(/u0002/gim,";")}if(!p&&!O){let u=e[t],E=/\bIF\b/i.test(u),h=/\bTHEN\b/i.test(u),$=/\bENDIF\b/i.test(u),q=E&&h&&$,Q=E&&!h&&/(AND|OR|NOT)\s*$/i.test(u.trim()),v=!1;if(e[t]=e[t].replace(m.REGEX.gm_GET_NESTING,""),e[t].search(new RegExp(B,"gi"))!==-1)c++;else if(e[t].search(new RegExp(g,"gi"))!==-1)S=!0;else if(e[t].search(new RegExp(i,"gi"))!==-1)c--,S=!0,c<0&&(c=0,S=!1);else if(e[t].search(new RegExp(R,"gi"))!==-1)c++;else if(e[t].search(new RegExp(w,"gi"))!==-1)S=!0;else if(e[t].search(new RegExp(_,"gi"))!==-1)c--,S=!0,c<0&&(c=0,S=!1);else if(D.EXCLUDE_KEYWORDS.some(N=>{r=`((?![^{]*})(${N}))`,e[t].search(new RegExp(r,"i"))!==-1&&(v=!0)}),b)h&&(c++,S=!0,b=!1);else if(!q)if(Q)b=!0,I=d;else for(let N of D.NESTINGS){if(v||(r=`((?![^{]*})(\\b${N.keyword})\\b)`,e[t].search(new RegExp(r,"i"))!==-1&&c++),N.multiline!==""&&(r=`((?![^{]*})(\\b${N.multiline})\\b)`,e[t].search(new RegExp(r,"i"))),N.middle!==""&&(r=`((?![^{]*})(\\b${N.middle})\\b)`,e[t].search(new RegExp(r,"i"))!==-1)){S=!0;break}if(r=`((?![^{]*})(\\b${N.end})\\b)`,e[t].search(new RegExp(r,"i"))!==-1){c--,c<0&&(c=0),S=!0;break}}}if(!p){let u=d;b?/\bIF\b/i.test(e[t])&&!/\bTHEN\b/i.test(e[t])||(u=I+2):S&&/\bTHEN\b/i.test(e[t])&&(u=Math.max(0,I+2||d));let E=fe(u,S,n);e[t]=E+e[t],d!==c&&(d=c),S=!1}}e=e.map(t=>t.replace(/[ \t]+$/g,""));for(let t=0;t<e.length;t++)t===e.length-1?e[t]!==""&&(l+=e[t],C&&(l+=m.CRLF)):l+=e[t]+m.CRLF;return l}function fe(o,n,l){let e="";if(o!==0){let r=l.ReplaceTabToSpaces!==!1,c=typeof l.IndentSize=="number"&&l.IndentSize>=1&&l.IndentSize<=10?l.IndentSize:4,d=r?" ".repeat(c):"	";for(let O=0;O<o;O++)n?n=!1:e+=d}return e}function G(o){return o===void 0||o===""||o===`
`||o==="\r"?!0:m.FORMATS.concat(m.SINGLE_OPERATORS,m.DOUBLE_OPERATORS,m.TRENNER).some(n=>o===n)}function ce(o,n){let l=H(o,n);l=U(l,n);let e=(n.allowedNumberOfEmptyLines||1)+1;if(n.RemoveEmptyLines){let d;n.EmptyLinesAlsoInComment?d=new RegExp(`(?![^{]*})(^[	]*$\r?
){${e},}`,"gm"):d=new RegExp(`(^[	]*$\r?
){${e},}`,"gm"),l=l.replace(d,m.CRLF)}let r=n.ReplaceTabToSpaces!==!1,c=typeof n.IndentSize=="number"&&n.IndentSize>=1&&n.IndentSize<=10?n.IndentSize:4;if(r){let d=/^\t+/gm;l=l.replace(d,O=>" ".repeat(O.length*c))}return l}});var K=F(k=>{"use strict";Object.defineProperty(k,"__esModule",{value:!0});k.preFormat=ge;k.formatNestings=ue;k.fullFormatPipeline=Ee;var M=W();function ge(o,n){return(0,M.preFormat)(o,n)}function ue(o,n){return(0,M.formatNestings)(o,n)}function Ee(o,n){return(0,M.pureFormatPipeline)(o,n)}});var j=F(a=>{"use strict";Object.defineProperty(a,"__esModule",{value:!0});a.info=a.config=void 0;a.formatTE=pe;a.getConfig=X;a.log=Re;a.cloneArray=Ce;var y=require("vscode"),T=require("vscode"),V=K(),me=P();a.config={};function pe(o){a.config=X();let n=T.window.activeTextEditor.document,l=de(o,n,a.config);return[y.TextEdit.replace(o,l)]}function de(o,n,l){let e,r=n.getText(o);r=(0,V.preFormat)(r,l),r=(0,V.formatNestings)(r,l);let c=(l.allowedNumberOfEmptyLines||1)+1;return l.RemoveEmptyLines&&(l.EmptyLinesAlsoInComment?e=new RegExp(`(?![^{]*})(^[	]*$\r?
){${c},}`,"gm"):e=new RegExp(`(^[	]*$\r?
){${c},}`,"gm"),r=r.replace(e,me.CRLF)),r}function X(){return a.config.debug=!1,a.config.debugToChannel=!0,a.config.allowedNumberOfEmptyLines=T.workspace.getConfiguration().get("VBI.formatter.EmptyLine.allowedNumberOfEmptyLines"),(a.config.allowedNumberOfEmptyLines<0||a.config.allowedNumberOfEmptyLines>50)&&(a.config.allowedNumberOfEmptyLines=1),a.config.RemoveEmptyLines=T.workspace.getConfiguration().get("VBI.formatter.EmptyLine.RemoveEmptyLines"),a.config.EmptyLinesAlsoInComment=T.workspace.getConfiguration().get("VBI.formatter.EmptyLine.EmptyLinesAlsoInComment"),a.config.BlockCodeBegin=T.workspace.getConfiguration().get("VBI.formatter.BC.BlockCodeBegin"),a.config.BlockCodeEnd=T.workspace.getConfiguration().get("VBI.formatter.BC.BlockCodeEnd"),a.config.BlockCodeExclude=T.workspace.getConfiguration().get("VBI.formatter.BC.BlockCodeExclude"),a.config.RegionBlockCodeBegin=T.workspace.getConfiguration().get("VBI.formatter.Region.BlockCodeBegin"),a.config.RegionBlockCodeEnd=T.workspace.getConfiguration().get("VBI.formatter.Region.BlockCodeEnd"),a.config.RegionBlockCodeExclude=T.workspace.getConfiguration().get("VBI.formatter.Region.BlockCodeExclude"),a.config.ReplaceTabToSpaces=T.workspace.getConfiguration().get("VBI.formatter.Misc.ReplaceTabToSpaces"),a.config.IndentSize=T.workspace.getConfiguration().get("VBI.formatter.Misc.IndentSize"),(typeof a.config.IndentSize!="number"||a.config.IndentSize<1||a.config.IndentSize>10)&&(a.config.IndentSize=4),typeof a.config.ReplaceTabToSpaces!="boolean"&&(a.config.ReplaceTabToSpaces=!0),console.log("getConfig():",a.config),a.config}a.info=y.window.createOutputChannel("VBI-Info");function Re(o,...n){function l(e){switch(typeof e){case"undefined":return"undefined";case"object":let r="";for(let[c,d]of Object.entries(e))r+=`${c}: ${d}
`;return r;default:return e}}if(a.config.debug)if(a.config.debugToChannel)switch(o.toLowerCase()){case"info":n.map(r=>{a.info.appendLine("INFO:"+l(r))}),a.info.show();return;case"warn":n.map(r=>{a.info.appendLine("WARN:"+l(r))}),a.info.show();return;case"error":let e="";n.map(r=>{e+=l(r)}),a.info.appendLine(e),y.window.showErrorMessage(e),a.info.show();return;default:n.map(r=>{a.info.appendLine("INFO-Other:"+l(r))}),a.info.show();return}else switch(o.toLowerCase()){case"info":console.log("INFO:",n);return;case"warn":console.log("WARNING:",n);return;case"error":console.error("ERROR:",n);return;default:console.log("log:",o,n);return}else if(o.toLowerCase()==="error"){let e="";n.map(r=>{e+=l(r)}),console.error("ERROR:",n),y.window.showErrorMessage(e);return}}function Ce(o){return[...o]}});Object.defineProperty(exports,"__esModule",{value:!0});exports.activate=we;exports.deactivate=Se;var L=require("vscode"),Z=j();function we(o){L.commands.registerCommand("vbi-format",()=>{let{activeTextEditor:n}=L.window;if(n){let{document:l}=n,e=new L.Position(0,0),r=new L.Position(l.lineCount-1,l.lineAt(l.lineCount-1).text.length),c=new L.Range(e,r);return(0,Z.formatTE)(c)}}),L.languages.registerDocumentFormattingEditProvider({scheme:"file",language:"intouch"},{provideDocumentFormattingEdits(n){let{activeTextEditor:l}=L.window,e=new L.Position(0,0),r=new L.Position(n.lineCount-1,n.lineAt(n.lineCount-1).text.length),c=new L.Range(e,r);return(0,Z.formatTE)(c)}})}function Se(){}
//# sourceMappingURL=extension.js.map

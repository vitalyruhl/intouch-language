"use strict";var y=(r,i)=>()=>(i||r((i={exports:{}}).exports,i),i.exports);var D=y(g=>{"use strict";Object.defineProperty(g,"__esModule",{value:!0});g.REGEX=g.KEYWORDS=g.TRENNER=g.NO_SPACE_ITEMS=g.DOUBLE_OPERATORS=g.SINGLE_OPERATORS=g.FORMATS=g.BACKSLASH=g.SQUOTE=g.DQUOTE=g.CRLF=g.LF=g.CR=g.TAB=void 0;g.TAB="	";g.CR="\r";g.LF=`
`;g.CRLF=`\r
`;g.DQUOTE='"';g.SQUOTE="'";g.BACKSLASH="\\";g.FORMATS=[g.TAB,g.CR,g.LF,g.CRLF,g.DQUOTE,g.SQUOTE,g.BACKSLASH];g.SINGLE_OPERATORS=["=","+","-","<",">","*","/","%","!","~","|"];g.DOUBLE_OPERATORS=["==","<>","<=",">="];g.NO_SPACE_ITEMS=["(",")","[","]",";"];g.TRENNER=[";"," "];g.KEYWORDS=["NULL","EOF","AS","IF","ENDIF","ELSE","WHILE","FOR","next","DIM","THEN","EXIT","EACH","STEP","IN","RETURN","CALL","MOD","AND","NOT","IS","OR","XOR","Abs","TO","SHL","SHR","discrete","integer","real","message","sqr","sin","cos","tan","atn","exp","log","int","frac","round","rnd","sqrt"];var J=new RegExp(/(?![^{]*})\t/,"gm"),ee=new RegExp(/\s{1,}/,"gm"),te=new RegExp(/\s{2,}/,"gm"),ne=new RegExp(/\s{2,}(?<!\t)/,"gm"),ie=new RegExp(/(}*{)/,"g"),oe=new RegExp(/(})/,"g"),re=new RegExp(/^\s*/,"g"),se=new RegExp(/(["'])(?:(?=(\\?))\2.)*?\1/,"gm"),le=new RegExp(/\s+(?=(?:(?:[^"]*"){2})*[^"]*"[^"]*$)/,"gm"),ae=new RegExp(/(-?\d*\.\d\w*)|([^\`\~\!\@\#\%\^\&\*\(\)\-\=\+\[\{\]\}\\\|\;\:\'\\"\,\.\<\>\/\?\s]+)/,"gm"),ce=new RegExp(/-?\d*\d/,"gm");g.REGEX={gm_TAB_NOT_IN_COMMENT:J,gm_MOR_1_WSP:ee,gm_MOR_2_WSP:te,g_CHECK_OPEN_COMMENT:ie,g_CHECK_CLOSE_COMMENT:oe,gm_GET_NESTING:re,gm_GET_STRING:se,gm_GET_WSP_IN_STRING:le,gm_MOR_2_WSP_NO_TAB:ne,gm_GET_ALL_WORDS:ae,gm_GET_ALL_Numbers:ce}});var W=y(x=>{"use strict";Object.defineProperty(x,"__esModule",{value:!0});x.NESTINGS=x.EXCLUDE_KEYWORDS=void 0;x.EXCLUDE_KEYWORDS=["EXIT FOR"];x.NESTINGS=[{keyword:"if",middle:"else",end:"endif",multiline:"then"},{keyword:"for",middle:"",end:"next",multiline:""},{keyword:"while",middle:"",end:"next",multiline:""}]});var V=y(P=>{"use strict";Object.defineProperty(P,"__esModule",{value:!0});P.preFormat=j;P.formatNestings=K;P.pureFormatPipeline=ge;var p=D(),H=W();function j(r,i){r=r.replace(/\r\n|\n|\r/g,`\r
`);let l=r.split(""),e="",s=0,u=1,_=0,T=!1,R=!1;for(let n=0;n<=l.length-1;n++)if(_++,s>0)s--;else{if(s=0,R&&l[n]==='"'?R=!1:!T&&l[n]==='"'&&(R=!0),l[n]===`
`){if(R)return r;u++,_=0}if(!T&&l[n]==="}")return r;if(l[n]==="{"?T=!0:T&&l[n]==="}"&&(T=!1),!R&&!(s>0)&&(!T||i.KeywordUppercaseAlsoInComment)){for(let d of p.KEYWORDS){let C=r.substr(n,d.length),O=r[n-1],w=r[n+d.length];if(C.toLowerCase()===d.toLowerCase()&&U(O)&&U(w)){e+=d.toUpperCase(),s=d.length-1;break}}if(!(s>0)){for(let d of p.DOUBLE_OPERATORS)if(r.substr(n,d.length)===d){r[n-1]!==" "&&(e+=" "),e+=d,r[n+d.length]!==" "&&(e+=" "),s=d.length-1;break}}if(!(s>0)){let d=w=>/[A-Za-z0-9_$]/.test(w||""),C=w=>/[A-Za-z]/.test(w||""),O=w=>/[A-Za-z0-9$-]/.test(w||"");for(let w of p.SINGLE_OPERATORS){if(l[n]!==w)continue;if(w==="-"){let o=r[n-1],m=r[n+1];if(O(o)&&O(m)){let E=n-1;for(;E>=0&&O(r[E]);)E--;E++;let h=n+1;for(;h<r.length&&O(r[h]);)h++;let S=r.slice(E,h);if(C(r[E])){e+="-",s=-1;break}}}let f=!1;if(w==="-"){let o=e.length-1;for(;o>=0&&/[ \t]/.test(e[o]);)o--;let m=o>=0?e[o]:void 0,E=r[n+1];(m===void 0||/[=+\-*/,(;{}]/.test(m)||m===`
`||m==="\r")&&/[0-9]/.test(E)&&(f=!0)}let t=!(w==="-"&&f);if(t&&e.length>0&&!/[ \t\r\n]/.test(e[e.length-1])&&(e+=" "),e+=w,t){let o=r[n+1];o&&!/[ \t\r\n]/.test(o)&&(e+=" ")}s=-1;break}}}s===0&&(e+=l[n])}e=e.replace(/\r\r\n/g,p.CRLF).replace(/\r(?!\n)/g,"");let F=e.split(p.CRLF).map(n=>n.replace(/\s+$/g,"")),B=[],k=0;for(let n of F)if(n===""){k++,k===1&&B.push("");continue}else k=0,B.push(n);let c=B.join(p.CRLF);return c=(()=>{let n="",d=!1,C=!1,O=0,w=f=>/[A-Za-z]/.test(f);for(let f=0;f<c.length;f++){let t=c[f];if(t==='"'){d=!d,n+=t;continue}if(!d){if(t==="{"){C=!0,n+=t;continue}if(t==="}"&&C&&(C=!1),!C&&(t==="i"||t==="I")&&(c[f+1]==="f"||c[f+1]==="F")){let o=f+2;for(;o<c.length&&c[o]===" ";)o++;if(c[o]==="("){n+="IF (";let m=o+1;for(;m<c.length&&c[m]===" ";)m++;O=1,f=m-1;continue}}if(!C&&t===")"){if(O>0){for(;n.length>0&&n[n.length-1]===" ";)n=n.slice(0,-1);O=0}n+=")";let o=f+1;for(;o<c.length&&c[o]===" ";)o++;if(c.slice(o,o+4).toLowerCase()==="then"){n+=" THEN",f=o+3;continue}let E=c[f+1];E&&w(E)&&(n+=" ");continue}if(!C&&(t==="T"||t==="t")&&c.slice(f,f+4).toLowerCase()==="then"){let o=f+4;for(;o<c.length&&c[o]===" ";)o++;if(c[o]==="{"){n+="THEN ",f=f+3;continue}}if(!C&&t===";"){let o=c[f+1];if(o&&o!==" "&&o!=="\r"&&o!==`
`){n+="; ";continue}}if(t==="}"){let o=f+1;for(;o<c.length&&c[o]===" ";)o++;if(o<c.length&&w(c[o])&&c[f+1]!==" "){n+="} ";continue}}if(!C&&/[A-Za-z0-9_]/.test(t)&&c[f+1]===" "&&c[f+2]==="-"&&/[A-Za-z_]/.test(c[f+3])){let o=n.length-1;for(;o>=0&&/[A-Za-z0-9$-]/.test(n[o]);)o--;let m=f+3;for(;m<c.length&&/[A-Za-z0-9$-]/.test(c[m]);)m++;let E=n.slice(o+1)+c.slice(f,m);if(!/^[A-Za-z][A-Za-z0-9$-]*-[A-Za-z0-9$-]*-[A-Za-z0-9$-]*$/.test(E)){n+=t+" - "+c[f+3],f+=3;continue}}if(!C&&t===","){for(;n.length>0&&n[n.length-1]===" ";)n=n.slice(0,-1);n+=",";let o=c[f+1];o&&o!==" "&&o!==")"&&o!=="\r"&&o!==`
`&&(n+=" ");continue}}n+=t}return n.replace(/= {2,}>/g,"= >")})(),c=c.split(p.CRLF).map(n=>{if(/^\s*\{[^{}]*\}\s*$/.test(n))return n;let d=n.indexOf("{"),C=n,O="";return d!==-1&&(C=n.slice(0,d),O=n.slice(d)),C.split(/("[^"\\]*(?:\\.[^"\\]*)*"?)/g).map(f=>f.startsWith('"')&&f.endsWith('"')?f:f.replace(/(\S)\s+;/g,"$1;")).join("")+O}).join(p.CRLF),c}function K(r,i){let l="",e=[],s="",u=0,_=0,T=!1,R=!1,F=!1,B=0,k=`^${i.BlockCodeBegin}`,c=`^${i.BlockCodeExclude}`,n=`^${i.BlockCodeEnd}`,d=`^${i.RegionBlockCodeBegin}`,C=`^${i.RegionBlockCodeExclude}`,O=`^${i.RegionBlockCodeEnd}`,w=r.endsWith(p.CRLF);e=r.split(p.CRLF);for(let t=0;t<e.length;t++){let o=!1;e[t]=e[t].replace(/\s+$/g,""),e[t]===""&&(o=!0),e[t].search(p.REGEX.g_CHECK_OPEN_COMMENT)!==-1&&(T=!0),e[t].search(p.REGEX.g_CHECK_CLOSE_COMMENT)!==-1&&(T=!1);let m=e[t].match(p.REGEX.gm_GET_STRING);if(m){let E=e[t];for(let h of m){let S=h.replace(/\s(?<!\t)/gim,"\0");S=S.replace(/\t/gim,"u0001"),S=S.replace(/;/g,"u0002"),E=E.replace(h,S)}if(e[t]=E.replace(p.REGEX.gm_MOR_2_WSP," "),!T){for(let h in p.NO_SPACE_ITEMS)s=`((?![^{]*})\\s\\${p.NO_SPACE_ITEMS[h]})`,e[t]=e[t].replace(new RegExp(s,"g"),`${p.NO_SPACE_ITEMS[h]}`),s=`((?![^{]*})(\\${p.NO_SPACE_ITEMS[h]}\\s))`,e[t]=e[t].replace(new RegExp(s,"g"),`${p.NO_SPACE_ITEMS[h]}`);e[t]=e[t].replace(/(?![^{]*});(?!\s)/g,"; "),e[t]=e[t].replace(/\s+;/g,";")}e[t]=e[t].replace(/\0/gim," ").replace(/u0001/gim,"	").replace(/u0002/gim,";")}if(!o&&!T){let E=e[t],h=/\bIF\b/i.test(E),S=/\bTHEN\b/i.test(E),L=/\bENDIF\b/i.test(E),b=h&&S&&L,$=h&&!S&&/(AND|OR|NOT)\s*$/i.test(E.trim()),v=!1;if(e[t]=e[t].replace(p.REGEX.gm_GET_NESTING,""),e[t].search(new RegExp(k,"gi"))!==-1)u++;else if(e[t].search(new RegExp(c,"gi"))!==-1)R=!0;else if(e[t].search(new RegExp(n,"gi"))!==-1)u--,R=!0,u<0&&(u=0,R=!1);else if(e[t].search(new RegExp(d,"gi"))!==-1)u++;else if(e[t].search(new RegExp(C,"gi"))!==-1)R=!0;else if(e[t].search(new RegExp(O,"gi"))!==-1)u--,R=!0,u<0&&(u=0,R=!1);else if(H.EXCLUDE_KEYWORDS.some(A=>{s=`((?![^{]*})(${A}))`,e[t].search(new RegExp(s,"i"))!==-1&&(v=!0)}),F)S&&(u++,R=!0,F=!1);else if(!b)if($)F=!0,B=_;else for(let A of H.NESTINGS){if(v||(s=`((?![^{]*})(\\b${A.keyword})\\b)`,e[t].search(new RegExp(s,"i"))!==-1&&u++),A.multiline!==""&&(s=`((?![^{]*})(\\b${A.multiline})\\b)`,e[t].search(new RegExp(s,"i"))),A.middle!==""&&(s=`((?![^{]*})(\\b${A.middle})\\b)`,e[t].search(new RegExp(s,"i"))!==-1)){R=!0;break}if(s=`((?![^{]*})(\\b${A.end})\\b)`,e[t].search(new RegExp(s,"i"))!==-1){u--,u<0&&(u=0),R=!0;break}}}if(!o){let E=_;F?/\bIF\b/i.test(e[t])&&!/\bTHEN\b/i.test(e[t])||(E=B+2):R&&/\bTHEN\b/i.test(e[t])&&(E=B+2,R=!1);let h=fe(E,R,i);e[t]=h+e[t],_!==u&&(_=u),R=!1}}e=e.map(t=>t.replace(/[ \t]+$/g,""));for(let t=0;t<e.length;t++)t===e.length-1?e[t]!==""&&(l+=e[t],w&&(l+=p.CRLF)):l+=e[t]+p.CRLF;return l.split(p.CRLF).map(t=>{if(t.trim()==="")return t;let o=t.match(/\{[^{}\r\n]*\}/g)||[],m=[],E=t;o.forEach((L,b)=>{let $=`@@C${b}@@`;m.push(L),E=E.replace(L,$)});let h=E.split(/("[^"\\]*(?:\\.[^"\\]*)*"?)/g).filter(L=>L!==""),S="";return h.forEach(L=>{if(L.startsWith('"')&&L.endsWith('"'))S+=L;else{let b=L.match(/^(\s*)(.*)$/);if(b){let $=b[1],v=b[2].replace(/ {2,}/g," ");S+=$+v}else S+=L.replace(/ {2,}/g," ")}}),m.forEach((L,b)=>{S=S.replace(`@@C${b}@@`,L)}),S}).join(p.CRLF)}function fe(r,i,l){let e="";if(r!==0){let s=l.ReplaceTabToSpaces!==!1,u=typeof l.IndentSize=="number"&&l.IndentSize>=1&&l.IndentSize<=10?l.IndentSize:4,_=s?" ".repeat(u):"	";for(let T=0;T<r;T++)i?i=!1:e+=_}return e}function U(r){return r===void 0||r===""||r===`
`||r==="\r"?!0:p.FORMATS.concat(p.SINGLE_OPERATORS,p.DOUBLE_OPERATORS,p.TRENNER).some(i=>r===i)}function ge(r,i){let l=j(r,i);l=K(l,i);let e=(i.allowedNumberOfEmptyLines||1)+1;if(i.RemoveEmptyLines){let _;i.EmptyLinesAlsoInComment?_=new RegExp(`(?![^{]*})(^[	]*$\r?
){${e},}`,"gm"):_=new RegExp(`(^[	]*$\r?
){${e},}`,"gm"),l=l.replace(_,p.CRLF)}let s=i.ReplaceTabToSpaces!==!1,u=typeof i.IndentSize=="number"&&i.IndentSize>=1&&i.IndentSize<=10?i.IndentSize:4;if(s){let _=/^\t+/gm;l=l.replace(_,T=>" ".repeat(T.length*u))}return l}});var X=y(M=>{"use strict";Object.defineProperty(M,"__esModule",{value:!0});M.preFormat=ue;M.formatNestings=Ee;M.fullFormatPipeline=pe;var G=V();function ue(r,i){return(0,G.preFormat)(r,i)}function Ee(r,i){return(0,G.formatNestings)(r,i)}function pe(r,i){return(0,G.pureFormatPipeline)(r,i)}});var Q=y(a=>{"use strict";Object.defineProperty(a,"__esModule",{value:!0});a.info=a.config=void 0;a.formatTE=de;a.getConfig=q;a.log=Ce;a.cloneArray=we;var z=require("vscode"),I=require("vscode"),Z=X(),me=D();a.config={};function de(r){a.config=q();let i=I.window.activeTextEditor.document,l=Re(r,i,a.config);return[z.TextEdit.replace(r,l)]}function Re(r,i,l){let e,s=i.getText(r);s=(0,Z.preFormat)(s,l),s=(0,Z.formatNestings)(s,l);let u=(l.allowedNumberOfEmptyLines||1)+1;return l.RemoveEmptyLines&&(l.EmptyLinesAlsoInComment?e=new RegExp(`(?![^{]*})(^[	]*$\r?
){${u},}`,"gm"):e=new RegExp(`(^[	]*$\r?
){${u},}`,"gm"),s=s.replace(e,me.CRLF)),s}function q(){return a.config.debug=!1,a.config.debugToChannel=!0,a.config.allowedNumberOfEmptyLines=I.workspace.getConfiguration().get("VBI.formatter.EmptyLine.allowedNumberOfEmptyLines"),(a.config.allowedNumberOfEmptyLines<0||a.config.allowedNumberOfEmptyLines>50)&&(a.config.allowedNumberOfEmptyLines=1),a.config.RemoveEmptyLines=I.workspace.getConfiguration().get("VBI.formatter.EmptyLine.RemoveEmptyLines"),a.config.EmptyLinesAlsoInComment=I.workspace.getConfiguration().get("VBI.formatter.EmptyLine.EmptyLinesAlsoInComment"),a.config.BlockCodeBegin=I.workspace.getConfiguration().get("VBI.formatter.BC.BlockCodeBegin"),a.config.BlockCodeEnd=I.workspace.getConfiguration().get("VBI.formatter.BC.BlockCodeEnd"),a.config.BlockCodeExclude=I.workspace.getConfiguration().get("VBI.formatter.BC.BlockCodeExclude"),a.config.RegionBlockCodeBegin=I.workspace.getConfiguration().get("VBI.formatter.Region.BlockCodeBegin"),a.config.RegionBlockCodeEnd=I.workspace.getConfiguration().get("VBI.formatter.Region.BlockCodeEnd"),a.config.RegionBlockCodeExclude=I.workspace.getConfiguration().get("VBI.formatter.Region.BlockCodeExclude"),a.config.ReplaceTabToSpaces=I.workspace.getConfiguration().get("VBI.formatter.Misc.ReplaceTabToSpaces"),a.config.IndentSize=I.workspace.getConfiguration().get("VBI.formatter.Misc.IndentSize"),(typeof a.config.IndentSize!="number"||a.config.IndentSize<1||a.config.IndentSize>10)&&(a.config.IndentSize=4),typeof a.config.ReplaceTabToSpaces!="boolean"&&(a.config.ReplaceTabToSpaces=!0),console.log("getConfig():",a.config),a.config}a.info=z.window.createOutputChannel("VBI-Info");function Ce(r,...i){function l(e){switch(typeof e){case"undefined":return"undefined";case"object":let s="";for(let[u,_]of Object.entries(e))s+=`${u}: ${_}
`;return s;default:return e}}if(a.config.debug)if(a.config.debugToChannel)switch(r.toLowerCase()){case"info":i.map(s=>{a.info.appendLine("INFO:"+l(s))}),a.info.show();return;case"warn":i.map(s=>{a.info.appendLine("WARN:"+l(s))}),a.info.show();return;case"error":let e="";i.map(s=>{e+=l(s)}),a.info.appendLine(e),z.window.showErrorMessage(e),a.info.show();return;default:i.map(s=>{a.info.appendLine("INFO-Other:"+l(s))}),a.info.show();return}else switch(r.toLowerCase()){case"info":console.log("INFO:",i);return;case"warn":console.log("WARNING:",i);return;case"error":console.error("ERROR:",i);return;default:console.log("log:",r,i);return}else if(r.toLowerCase()==="error"){let e="";i.map(s=>{e+=l(s)}),console.error("ERROR:",i),z.window.showErrorMessage(e);return}}function we(r){return[...r]}});Object.defineProperty(exports,"__esModule",{value:!0});exports.activate=he;exports.deactivate=Se;var N=require("vscode"),Y=Q();function he(r){N.commands.registerCommand("vbi-format",()=>{let{activeTextEditor:i}=N.window;if(i){let{document:l}=i,e=new N.Position(0,0),s=new N.Position(l.lineCount-1,l.lineAt(l.lineCount-1).text.length),u=new N.Range(e,s);return(0,Y.formatTE)(u)}}),N.languages.registerDocumentFormattingEditProvider({scheme:"file",language:"intouch"},{provideDocumentFormattingEdits(i){let{activeTextEditor:l}=N.window,e=new N.Position(0,0),s=new N.Position(i.lineCount-1,i.lineAt(i.lineCount-1).text.length),u=new N.Range(e,s);return(0,Y.formatTE)(u)}})}function Se(){}
//# sourceMappingURL=extension.js.map

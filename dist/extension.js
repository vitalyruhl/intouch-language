"use strict";var $=(r,i)=>()=>(i||r((i={exports:{}}).exports,i),i.exports);var D=$(f=>{"use strict";Object.defineProperty(f,"__esModule",{value:!0});f.REGEX=f.KEYWORDS=f.TRENNER=f.NO_SPACE_ITEMS=f.DOUBLE_OPERATORS=f.SINGLE_OPERATORS=f.FORMATS=f.BACKSLASH=f.SQUOTE=f.DQUOTE=f.CRLF=f.LF=f.CR=f.TAB=void 0;f.TAB="	";f.CR="\r";f.LF=`
`;f.CRLF=`\r
`;f.DQUOTE='"';f.SQUOTE="'";f.BACKSLASH="\\";f.FORMATS=[f.TAB,f.CR,f.LF,f.CRLF,f.DQUOTE,f.SQUOTE,f.BACKSLASH];f.SINGLE_OPERATORS=["=","+","-","<",">","*","/","%","!","~","|"];f.DOUBLE_OPERATORS=["==","<>","<=",">="];f.NO_SPACE_ITEMS=["(",")","[","]",";"];f.TRENNER=[";"," "];f.KEYWORDS=["NULL","EOF","AS","IF","ENDIF","ELSE","WHILE","FOR","next","DIM","THEN","EXIT","EACH","STEP","IN","RETURN","CALL","MOD","AND","NOT","IS","OR","XOR","Abs","TO","SHL","SHR","discrete","integer","real","message","sqr","sin","cos","tan","atn","exp","log","int","frac","round","rnd","sqrt"];var J=new RegExp(/(?![^{]*})\t/,"gm"),ee=new RegExp(/\s{1,}/,"gm"),te=new RegExp(/\s{2,}/,"gm"),ne=new RegExp(/\s{2,}(?<!\t)/,"gm"),ie=new RegExp(/(}*{)/,"g"),oe=new RegExp(/(})/,"g"),re=new RegExp(/^\s*/,"g"),se=new RegExp(/(["'])(?:(?=(\\?))\2.)*?\1/,"gm"),le=new RegExp(/\s+(?=(?:(?:[^"]*"){2})*[^"]*"[^"]*$)/,"gm"),ae=new RegExp(/(-?\d*\.\d\w*)|([^\`\~\!\@\#\%\^\&\*\(\)\-\=\+\[\{\]\}\\\|\;\:\'\\"\,\.\<\>\/\?\s]+)/,"gm"),ce=new RegExp(/-?\d*\d/,"gm");f.REGEX={gm_TAB_NOT_IN_COMMENT:J,gm_MOR_1_WSP:ee,gm_MOR_2_WSP:te,g_CHECK_OPEN_COMMENT:ie,g_CHECK_CLOSE_COMMENT:oe,gm_GET_NESTING:re,gm_GET_STRING:se,gm_GET_WSP_IN_STRING:le,gm_MOR_2_WSP_NO_TAB:ne,gm_GET_ALL_WORDS:ae,gm_GET_ALL_Numbers:ce}});var W=$(k=>{"use strict";Object.defineProperty(k,"__esModule",{value:!0});k.NESTINGS=k.EXCLUDE_KEYWORDS=void 0;k.EXCLUDE_KEYWORDS=["EXIT FOR"];k.NESTINGS=[{keyword:"if",middle:"else",end:"endif",multiline:"then"},{keyword:"for",middle:"",end:"next",multiline:""},{keyword:"while",middle:"",end:"next",multiline:""}]});var V=$(P=>{"use strict";Object.defineProperty(P,"__esModule",{value:!0});P.preFormat=j;P.formatNestings=K;P.pureFormatPipeline=ge;var p=D(),H=W();function j(r,i){r=r.replace(/\r\n|\n|\r/g,`\r
`);let l=r.split(""),e="",s=0,u=1,S=0,_=!1,d=!1;for(let n=0;n<=l.length-1;n++)if(S++,s>0)s--;else{if(s=0,d&&l[n]==='"'?d=!1:!_&&l[n]==='"'&&(d=!0),l[n]===`
`){if(d)return r;u++,S=0}if(!_&&l[n]==="}")return r;if(l[n]==="{"?_=!0:_&&l[n]==="}"&&(_=!1),!d&&!(s>0)&&(!_||i.KeywordUppercaseAlsoInComment)){for(let C of p.KEYWORDS){let T=r.substr(n,C.length),L=r[n-1],w=r[n+C.length];if(T.toLowerCase()===C.toLowerCase()&&U(L)&&U(w)){e+=C.toUpperCase(),s=C.length-1;break}}if(!(s>0)){for(let C of p.DOUBLE_OPERATORS)if(r.substr(n,C.length)===C){r[n-1]!==" "&&(e+=" "),e+=C,r[n+C.length]!==" "&&(e+=" "),s=C.length-1;break}}if(!(s>0)){let C=w=>/[A-Za-z0-9_$]/.test(w||""),T=w=>/[A-Za-z]/.test(w||""),L=w=>/[A-Za-z0-9$-]/.test(w||"");for(let w of p.SINGLE_OPERATORS){if(l[n]!==w)continue;if(w==="-"){let o=r[n-1],m=r[n+1];if(L(o)&&L(m)){let E=n-1;for(;E>=0&&L(r[E]);)E--;E++;let R=n+1;for(;R<r.length&&L(r[R]);)R++;let h=r.slice(E,R);if(T(r[E])){e+="-",s=-1;break}}}let g=!1;if(w==="-"){let o=e.length-1;for(;o>=0&&/[ \t]/.test(e[o]);)o--;let m=o>=0?e[o]:void 0,E=r[n+1];(m===void 0||/[=+\-*/,(;{}]/.test(m)||m===`
`||m==="\r")&&/[0-9]/.test(E)&&(g=!0)}let t=!(w==="-"&&g);if(t&&e.length>0&&!/[ \t\r\n]/.test(e[e.length-1])&&(e+=" "),e+=w,t){let o=r[n+1];o&&!/[ \t\r\n]/.test(o)&&(e+=" ")}s=-1;break}}}s===0&&(e+=l[n])}e=e.replace(/\r\r\n/g,p.CRLF).replace(/\r(?!\n)/g,"");let F=e.split(p.CRLF).map(n=>n.replace(/\s+$/g,"")),B=[],x=0;for(let n of F)if(n===""){x++,x===1&&B.push("");continue}else x=0,B.push(n);let c=B.join(p.CRLF);return c=(()=>{let n="",C=!1,T=!1,L=0,w=g=>/[A-Za-z]/.test(g);for(let g=0;g<c.length;g++){let t=c[g];if(t==='"'){C=!C,n+=t;continue}if(!C){if(t==="{"){T=!0,n+=t;continue}if(t==="}"&&T&&(T=!1),!T&&(t==="i"||t==="I")&&(c[g+1]==="f"||c[g+1]==="F")){let o=g+2;for(;o<c.length&&c[o]===" ";)o++;if(c[o]==="("){n+="IF (";let m=o+1;for(;m<c.length&&c[m]===" ";)m++;L=1,g=m-1;continue}}if(!T&&t===")"){if(L>0){for(;n.length>0&&n[n.length-1]===" ";)n=n.slice(0,-1);L=0}n+=")";let o=g+1;for(;o<c.length&&c[o]===" ";)o++;if(c.slice(o,o+4).toLowerCase()==="then"){n+=" THEN",g=o+3;continue}let E=c[g+1];E&&w(E)&&(n+=" ");continue}if(!T&&(t==="T"||t==="t")&&c.slice(g,g+4).toLowerCase()==="then"){let o=g+4;for(;o<c.length&&c[o]===" ";)o++;if(c[o]==="{"){n+="THEN ",g=g+3;continue}}if(!T&&t===";"){let o=c[g+1];if(o&&o!==" "&&o!=="\r"&&o!==`
`){n+="; ";continue}}if(t==="}"){let o=g+1;for(;o<c.length&&c[o]===" ";)o++;if(o<c.length&&w(c[o])&&c[g+1]!==" "){n+="} ";continue}}if(!T&&/[A-Za-z0-9_]/.test(t)&&c[g+1]===" "&&c[g+2]==="-"&&/[A-Za-z_]/.test(c[g+3])){let o=n.length-1;for(;o>=0&&/[A-Za-z0-9$-]/.test(n[o]);)o--;let m=g+3;for(;m<c.length&&/[A-Za-z0-9$-]/.test(c[m]);)m++;let E=n.slice(o+1)+c.slice(g,m);if(!/^[A-Za-z][A-Za-z0-9$-]*-[A-Za-z0-9$-]*-[A-Za-z0-9$-]*$/.test(E)){n+=t+" - "+c[g+3],g+=3;continue}}if(!T&&t===","){for(;n.length>0&&n[n.length-1]===" ";)n=n.slice(0,-1);n+=",";let o=c[g+1];o&&o!==" "&&o!==")"&&o!=="\r"&&o!==`
`&&(n+=" ");continue}}n+=t}return n.replace(/= {2,}>/g,"= >")})(),c=c.split(/(\"[^\"]*\")/g).map(n=>n.startsWith('"')&&n.endsWith('"')?n:n.replace(/(\S)\s+;/g,"$1;")).join(""),c}function K(r,i){let l="",e=[],s="",u=0,S=0,_=!1,d=!1,F=!1,B=0,x=`^${i.BlockCodeBegin}`,c=`^${i.BlockCodeExclude}`,n=`^${i.BlockCodeEnd}`,C=`^${i.RegionBlockCodeBegin}`,T=`^${i.RegionBlockCodeExclude}`,L=`^${i.RegionBlockCodeEnd}`,w=r.endsWith(p.CRLF);e=r.split(p.CRLF);for(let t=0;t<e.length;t++){let o=!1;e[t]=e[t].replace(/\s+$/g,""),e[t]===""&&(o=!0),e[t].search(p.REGEX.g_CHECK_OPEN_COMMENT)!==-1&&(_=!0),e[t].search(p.REGEX.g_CHECK_CLOSE_COMMENT)!==-1&&(_=!1);let m=e[t].match(p.REGEX.gm_GET_STRING);if(m){let E=e[t];for(let R of m){let h=R.replace(/\s(?<!\t)/gim,"\0");h=h.replace(/\t/gim,"u0001"),h=h.replace(/;/g,"u0002"),E=E.replace(R,h)}if(e[t]=E.replace(p.REGEX.gm_MOR_2_WSP," "),!_){for(let R in p.NO_SPACE_ITEMS)s=`((?![^{]*})\\s\\${p.NO_SPACE_ITEMS[R]})`,e[t]=e[t].replace(new RegExp(s,"g"),`${p.NO_SPACE_ITEMS[R]}`),s=`((?![^{]*})(\\${p.NO_SPACE_ITEMS[R]}\\s))`,e[t]=e[t].replace(new RegExp(s,"g"),`${p.NO_SPACE_ITEMS[R]}`);e[t]=e[t].replace(/(?![^{]*});(?!\s)/g,"; "),e[t]=e[t].replace(/\s+;/g,";")}e[t]=e[t].replace(/\0/gim," ").replace(/u0001/gim,"	").replace(/u0002/gim,";")}if(!o&&!_){let E=e[t],R=/\bIF\b/i.test(E),h=/\bTHEN\b/i.test(E),O=/\bENDIF\b/i.test(E),b=R&&h&&O,y=R&&!h&&/(AND|OR|NOT)\s*$/i.test(E.trim()),v=!1;if(e[t]=e[t].replace(p.REGEX.gm_GET_NESTING,""),e[t].search(new RegExp(x,"gi"))!==-1)u++;else if(e[t].search(new RegExp(c,"gi"))!==-1)d=!0;else if(e[t].search(new RegExp(n,"gi"))!==-1)u--,d=!0,u<0&&(u=0,d=!1);else if(e[t].search(new RegExp(C,"gi"))!==-1)u++;else if(e[t].search(new RegExp(T,"gi"))!==-1)d=!0;else if(e[t].search(new RegExp(L,"gi"))!==-1)u--,d=!0,u<0&&(u=0,d=!1);else if(H.EXCLUDE_KEYWORDS.some(A=>{s=`((?![^{]*})(${A}))`,e[t].search(new RegExp(s,"i"))!==-1&&(v=!0)}),F)h&&(u++,d=!0,F=!1);else if(!b)if(y)F=!0,B=S;else for(let A of H.NESTINGS){if(v||(s=`((?![^{]*})(\\b${A.keyword})\\b)`,e[t].search(new RegExp(s,"i"))!==-1&&u++),A.multiline!==""&&(s=`((?![^{]*})(\\b${A.multiline})\\b)`,e[t].search(new RegExp(s,"i"))),A.middle!==""&&(s=`((?![^{]*})(\\b${A.middle})\\b)`,e[t].search(new RegExp(s,"i"))!==-1)){d=!0;break}if(s=`((?![^{]*})(\\b${A.end})\\b)`,e[t].search(new RegExp(s,"i"))!==-1){u--,u<0&&(u=0),d=!0;break}}}if(!o){let E=S;F?/\bIF\b/i.test(e[t])&&!/\bTHEN\b/i.test(e[t])||(E=B+2):d&&/\bTHEN\b/i.test(e[t])&&(E=B+2,d=!1);let R=fe(E,d,i);e[t]=R+e[t],S!==u&&(S=u),d=!1}}e=e.map(t=>t.replace(/[ \t]+$/g,""));for(let t=0;t<e.length;t++)t===e.length-1?e[t]!==""&&(l+=e[t],w&&(l+=p.CRLF)):l+=e[t]+p.CRLF;return l.split(p.CRLF).map(t=>{if(t.trim()==="")return t;let o=t.match(/\{[^{}\r\n]*\}/g)||[],m=[],E=t;o.forEach((O,b)=>{let y=`@@C${b}@@`;m.push(O),E=E.replace(O,y)});let R=E.split(/("[^"\\]*(?:\\.[^"\\]*)*"?)/g).filter(O=>O!==""),h="";return R.forEach(O=>{if(O.startsWith('"')&&O.endsWith('"'))h+=O;else{let b=O.match(/^(\s*)(.*)$/);if(b){let y=b[1],v=b[2].replace(/ {2,}/g," ");h+=y+v}else h+=O.replace(/ {2,}/g," ")}}),m.forEach((O,b)=>{h=h.replace(`@@C${b}@@`,O)}),h}).join(p.CRLF)}function fe(r,i,l){let e="";if(r!==0){let s=l.ReplaceTabToSpaces!==!1,u=typeof l.IndentSize=="number"&&l.IndentSize>=1&&l.IndentSize<=10?l.IndentSize:4,S=s?" ".repeat(u):"	";for(let _=0;_<r;_++)i?i=!1:e+=S}return e}function U(r){return r===void 0||r===""||r===`
`||r==="\r"?!0:p.FORMATS.concat(p.SINGLE_OPERATORS,p.DOUBLE_OPERATORS,p.TRENNER).some(i=>r===i)}function ge(r,i){let l=j(r,i);l=K(l,i);let e=(i.allowedNumberOfEmptyLines||1)+1;if(i.RemoveEmptyLines){let S;i.EmptyLinesAlsoInComment?S=new RegExp(`(?![^{]*})(^[	]*$\r?
){${e},}`,"gm"):S=new RegExp(`(^[	]*$\r?
){${e},}`,"gm"),l=l.replace(S,p.CRLF)}let s=i.ReplaceTabToSpaces!==!1,u=typeof i.IndentSize=="number"&&i.IndentSize>=1&&i.IndentSize<=10?i.IndentSize:4;if(s){let S=/^\t+/gm;l=l.replace(S,_=>" ".repeat(_.length*u))}return l}});var X=$(M=>{"use strict";Object.defineProperty(M,"__esModule",{value:!0});M.preFormat=ue;M.formatNestings=Ee;M.fullFormatPipeline=pe;var G=V();function ue(r,i){return(0,G.preFormat)(r,i)}function Ee(r,i){return(0,G.formatNestings)(r,i)}function pe(r,i){return(0,G.pureFormatPipeline)(r,i)}});var Q=$(a=>{"use strict";Object.defineProperty(a,"__esModule",{value:!0});a.info=a.config=void 0;a.formatTE=de;a.getConfig=q;a.log=Ce;a.cloneArray=we;var z=require("vscode"),N=require("vscode"),Z=X(),me=D();a.config={};function de(r){a.config=q();let i=N.window.activeTextEditor.document,l=Re(r,i,a.config);return[z.TextEdit.replace(r,l)]}function Re(r,i,l){let e,s=i.getText(r);s=(0,Z.preFormat)(s,l),s=(0,Z.formatNestings)(s,l);let u=(l.allowedNumberOfEmptyLines||1)+1;return l.RemoveEmptyLines&&(l.EmptyLinesAlsoInComment?e=new RegExp(`(?![^{]*})(^[	]*$\r?
){${u},}`,"gm"):e=new RegExp(`(^[	]*$\r?
){${u},}`,"gm"),s=s.replace(e,me.CRLF)),s}function q(){return a.config.debug=!1,a.config.debugToChannel=!0,a.config.allowedNumberOfEmptyLines=N.workspace.getConfiguration().get("VBI.formatter.EmptyLine.allowedNumberOfEmptyLines"),(a.config.allowedNumberOfEmptyLines<0||a.config.allowedNumberOfEmptyLines>50)&&(a.config.allowedNumberOfEmptyLines=1),a.config.RemoveEmptyLines=N.workspace.getConfiguration().get("VBI.formatter.EmptyLine.RemoveEmptyLines"),a.config.EmptyLinesAlsoInComment=N.workspace.getConfiguration().get("VBI.formatter.EmptyLine.EmptyLinesAlsoInComment"),a.config.BlockCodeBegin=N.workspace.getConfiguration().get("VBI.formatter.BC.BlockCodeBegin"),a.config.BlockCodeEnd=N.workspace.getConfiguration().get("VBI.formatter.BC.BlockCodeEnd"),a.config.BlockCodeExclude=N.workspace.getConfiguration().get("VBI.formatter.BC.BlockCodeExclude"),a.config.RegionBlockCodeBegin=N.workspace.getConfiguration().get("VBI.formatter.Region.BlockCodeBegin"),a.config.RegionBlockCodeEnd=N.workspace.getConfiguration().get("VBI.formatter.Region.BlockCodeEnd"),a.config.RegionBlockCodeExclude=N.workspace.getConfiguration().get("VBI.formatter.Region.BlockCodeExclude"),a.config.ReplaceTabToSpaces=N.workspace.getConfiguration().get("VBI.formatter.Misc.ReplaceTabToSpaces"),a.config.IndentSize=N.workspace.getConfiguration().get("VBI.formatter.Misc.IndentSize"),(typeof a.config.IndentSize!="number"||a.config.IndentSize<1||a.config.IndentSize>10)&&(a.config.IndentSize=4),typeof a.config.ReplaceTabToSpaces!="boolean"&&(a.config.ReplaceTabToSpaces=!0),console.log("getConfig():",a.config),a.config}a.info=z.window.createOutputChannel("VBI-Info");function Ce(r,...i){function l(e){switch(typeof e){case"undefined":return"undefined";case"object":let s="";for(let[u,S]of Object.entries(e))s+=`${u}: ${S}
`;return s;default:return e}}if(a.config.debug)if(a.config.debugToChannel)switch(r.toLowerCase()){case"info":i.map(s=>{a.info.appendLine("INFO:"+l(s))}),a.info.show();return;case"warn":i.map(s=>{a.info.appendLine("WARN:"+l(s))}),a.info.show();return;case"error":let e="";i.map(s=>{e+=l(s)}),a.info.appendLine(e),z.window.showErrorMessage(e),a.info.show();return;default:i.map(s=>{a.info.appendLine("INFO-Other:"+l(s))}),a.info.show();return}else switch(r.toLowerCase()){case"info":console.log("INFO:",i);return;case"warn":console.log("WARNING:",i);return;case"error":console.error("ERROR:",i);return;default:console.log("log:",r,i);return}else if(r.toLowerCase()==="error"){let e="";i.map(s=>{e+=l(s)}),console.error("ERROR:",i),z.window.showErrorMessage(e);return}}function we(r){return[...r]}});Object.defineProperty(exports,"__esModule",{value:!0});exports.activate=he;exports.deactivate=Se;var I=require("vscode"),Y=Q();function he(r){I.commands.registerCommand("vbi-format",()=>{let{activeTextEditor:i}=I.window;if(i){let{document:l}=i,e=new I.Position(0,0),s=new I.Position(l.lineCount-1,l.lineAt(l.lineCount-1).text.length),u=new I.Range(e,s);return(0,Y.formatTE)(u)}}),I.languages.registerDocumentFormattingEditProvider({scheme:"file",language:"intouch"},{provideDocumentFormattingEdits(i){let{activeTextEditor:l}=I.window,e=new I.Position(0,0),s=new I.Position(i.lineCount-1,i.lineAt(i.lineCount-1).text.length),u=new I.Range(e,s);return(0,Y.formatTE)(u)}})}function Se(){}
//# sourceMappingURL=extension.js.map

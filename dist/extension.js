"use strict";var y=(r,i)=>()=>(i||r((i={exports:{}}).exports,i),i.exports);var D=y(g=>{"use strict";Object.defineProperty(g,"__esModule",{value:!0});g.REGEX=g.KEYWORDS=g.TRENNER=g.NO_SPACE_ITEMS=g.DOUBLE_OPERATORS=g.SINGLE_OPERATORS=g.FORMATS=g.BACKSLASH=g.SQUOTE=g.DQUOTE=g.CRLF=g.LF=g.CR=g.TAB=void 0;g.TAB="	";g.CR="\r";g.LF=`
`;g.CRLF=`\r
`;g.DQUOTE='"';g.SQUOTE="'";g.BACKSLASH="\\";g.FORMATS=[g.TAB,g.CR,g.LF,g.CRLF,g.DQUOTE,g.SQUOTE,g.BACKSLASH];g.SINGLE_OPERATORS=["=","+","-","<",">","*","/","%","!","~","|"];g.DOUBLE_OPERATORS=["==","<>","<=",">="];g.NO_SPACE_ITEMS=["(",")","[","]",";"];g.TRENNER=[";"," "];g.KEYWORDS=["NULL","EOF","AS","IF","ENDIF","ELSE","WHILE","FOR","next","DIM","THEN","EXIT","EACH","STEP","IN","RETURN","CALL","MOD","AND","NOT","IS","OR","XOR","Abs","TO","SHL","SHR","discrete","integer","real","message","sqr","sin","cos","tan","atn","exp","log","int","frac","round","rnd","sqrt"];var te=new RegExp(/(?![^{]*})\t/,"gm"),ne=new RegExp(/\s{1,}/,"gm"),ie=new RegExp(/\s{2,}/,"gm"),oe=new RegExp(/\s{2,}(?<!\t)/,"gm"),re=new RegExp(/(}*{)/,"g"),se=new RegExp(/(})/,"g"),le=new RegExp(/^\s*/,"g"),ae=new RegExp(/(["'])(?:(?=(\\?))\2.)*?\1/,"gm"),ce=new RegExp(/\s+(?=(?:(?:[^"]*"){2})*[^"]*"[^"]*$)/,"gm"),fe=new RegExp(/(-?\d*\.\d\w*)|([^\`\~\!\@\#\%\^\&\*\(\)\-\=\+\[\{\]\}\\\|\;\:\'\\"\,\.\<\>\/\?\s]+)/,"gm"),ge=new RegExp(/-?\d*\d/,"gm");g.REGEX={gm_TAB_NOT_IN_COMMENT:te,gm_MOR_1_WSP:ne,gm_MOR_2_WSP:ie,g_CHECK_OPEN_COMMENT:re,g_CHECK_CLOSE_COMMENT:se,gm_GET_NESTING:le,gm_GET_STRING:ae,gm_GET_WSP_IN_STRING:ce,gm_MOR_2_WSP_NO_TAB:oe,gm_GET_ALL_WORDS:fe,gm_GET_ALL_Numbers:ge}});var H=y(k=>{"use strict";Object.defineProperty(k,"__esModule",{value:!0});k.NESTINGS=k.EXCLUDE_KEYWORDS=void 0;k.EXCLUDE_KEYWORDS=["EXIT FOR"];k.NESTINGS=[{keyword:"if",middle:"else",end:"endif",multiline:"then"},{keyword:"for",middle:"",end:"next",multiline:""},{keyword:"while",middle:"",end:"next",multiline:""}]});var X=y(P=>{"use strict";Object.defineProperty(P,"__esModule",{value:!0});P.preFormat=K;P.formatNestings=V;P.pureFormatPipeline=Ee;var E=D(),U=H();function K(r,i){r=r.replace(/\r\n|\n|\r/g,`\r
`);let l=r.split(""),e="",s=0,u=1,C=0,T=!1,w=!1;for(let n=0;n<=l.length-1;n++)if(C++,s>0)s--;else{if(s=0,w&&l[n]==='"'?w=!1:!T&&l[n]==='"'&&(w=!0),l[n]===`
`){if(w)return r;u++,C=0}if(!T&&l[n]==="}")return r;if(l[n]==="{"?T=!0:T&&l[n]==="}"&&(T=!1),!w&&!(s>0)&&(!T||i.KeywordUppercaseAlsoInComment)){for(let d of E.KEYWORDS){let h=r.substr(n,d.length),L=r[n-1],S=r[n+d.length];if(h.toLowerCase()===d.toLowerCase()&&j(L)&&j(S)){e+=d.toUpperCase(),s=d.length-1;break}}if(!(s>0)){for(let d of E.DOUBLE_OPERATORS)if(r.substr(n,d.length)===d){r[n-1]!==" "&&(e+=" "),e+=d,r[n+d.length]!==" "&&(e+=" "),s=d.length-1;break}}if(!(s>0)){let d=S=>/[A-Za-z0-9_$]/.test(S||""),h=S=>/[A-Za-z]/.test(S||""),L=S=>/[A-Za-z0-9$-]/.test(S||"");for(let S of E.SINGLE_OPERATORS){if(l[n]!==S)continue;if(S==="-"){let o=r[n-1],m=r[n+1];if(L(o)&&L(m)){let R=n-1;for(;R>=0&&L(r[R]);)R--;R++;let b=n+1;for(;b<r.length&&L(r[b]);)b++;let O=r.slice(R,b);if(h(r[R])){e+="-",s=-1;break}}}let f=!1;if(S==="-"){let o=e.length-1;for(;o>=0&&/[ \t]/.test(e[o]);)o--;let m=o>=0?e[o]:void 0,R=r[n+1];(m===void 0||/[=+\-*/,(;{}]/.test(m)||m===`
`||m==="\r")&&/[0-9]/.test(R)&&(f=!0)}let t=!(S==="-"&&f);if(t&&e.length>0&&!/[ \t\r\n]/.test(e[e.length-1])&&(e+=" "),e+=S,t){let o=r[n+1];o&&!/[ \t\r\n]/.test(o)&&(e+=" ")}s=-1;break}}}s===0&&(e+=l[n])}e=e.replace(/\r\r\n/g,E.CRLF).replace(/\r(?!\n)/g,"");let B=e.split(E.CRLF).map(n=>n.replace(/\s+$/g,"")),F=[],$=0;for(let n of B)if(n===""){$++,$===1&&F.push("");continue}else $=0,F.push(n);let c=F.join(E.CRLF);return c=(()=>{let n="",d=!1,h=!1,L=0,S=f=>/[A-Za-z]/.test(f);for(let f=0;f<c.length;f++){let t=c[f];if(t==='"'){d=!d,n+=t;continue}if(!d){if(t==="{"){h=!0,n+=t;continue}if(t==="}"&&h&&(h=!1),!h&&(t==="i"||t==="I")&&(c[f+1]==="f"||c[f+1]==="F")){let o=f+2;for(;o<c.length&&c[o]===" ";)o++;if(c[o]==="("){n+="IF (";let m=o+1;for(;m<c.length&&c[m]===" ";)m++;L=1,f=m-1;continue}}if(!h&&t===")"){if(L>0){for(;n.length>0&&n[n.length-1]===" ";)n=n.slice(0,-1);L=0}n+=")";let o=f+1;for(;o<c.length&&c[o]===" ";)o++;if(c.slice(o,o+4).toLowerCase()==="then"){n+=" THEN",f=o+3;continue}let R=c[f+1];R&&S(R)&&(n+=" ");continue}if(!h&&(t==="T"||t==="t")&&c.slice(f,f+4).toLowerCase()==="then"){let o=f+4;for(;o<c.length&&c[o]===" ";)o++;if(c[o]==="{"){n+="THEN ",f=f+3;continue}}if(!h&&t===";"){let o=c[f+1];if(o&&o!==" "&&o!=="\r"&&o!==`
`){n+="; ";continue}}if(t==="}"){let o=f+1;for(;o<c.length&&c[o]===" ";)o++;if(o<c.length&&S(c[o])&&c[f+1]!==" "){n+="} ";continue}}if(!h&&/[A-Za-z0-9_]/.test(t)&&c[f+1]===" "&&c[f+2]==="-"&&/[A-Za-z_]/.test(c[f+3])){let o=n.length-1;for(;o>=0&&/[A-Za-z0-9$-]/.test(n[o]);)o--;let m=f+3;for(;m<c.length&&/[A-Za-z0-9$-]/.test(c[m]);)m++;let R=n.slice(o+1)+c.slice(f,m);if(!/^[A-Za-z][A-Za-z0-9$-]*-[A-Za-z0-9$-]*-[A-Za-z0-9$-]*$/.test(R)){n+=t+" - "+c[f+3],f+=3;continue}}if(!h&&t===","){for(;n.length>0&&n[n.length-1]===" ";)n=n.slice(0,-1);n+=",";let o=c[f+1];o&&o!==" "&&o!==")"&&o!=="\r"&&o!==`
`&&(n+=" ");continue}}n+=t}return n.replace(/= {2,}>/g,"= >")})(),c=c.split(E.CRLF).map(n=>{if(/^\s*\{[^{}]*\}\s*$/.test(n))return n;let d=n.indexOf("{"),h=n,L="";return d!==-1&&(h=n.slice(0,d),L=n.slice(d)),h.split(/("[^"\\]*(?:\\.[^"\\]*)*"?)/g).map(f=>f.startsWith('"')&&f.endsWith('"')?f:f.replace(/(\S)\s+;/g,"$1;")).join("")+L}).join(E.CRLF),c}function V(r,i){let l="",e=[],s="",u=0,C=0,T=!1,w=!1,B=!1,F=0,$=`^${i.BlockCodeBegin}`,c=`^${i.BlockCodeExclude}`,n=`^${i.BlockCodeEnd}`,d=`^${i.RegionBlockCodeBegin}`,h=`^${i.RegionBlockCodeExclude}`,L=`^${i.RegionBlockCodeEnd}`,S=r.endsWith(E.CRLF);e=r.split(E.CRLF);for(let t=0;t<e.length;t++){let o=T,m=!1;e[t]=e[t].replace(/\s+$/g,""),e[t]===""&&(m=!0),e[t].search(E.REGEX.g_CHECK_OPEN_COMMENT)!==-1&&(T=!0),e[t].search(E.REGEX.g_CHECK_CLOSE_COMMENT)!==-1&&(T=!1);let R=e[t].match(E.REGEX.gm_GET_STRING);if(R){let O=e[t];for(let p of R){let _=p.replace(/\s(?<!\t)/gim,"\0");_=_.replace(/\t/gim,"u0001"),_=_.replace(/;/g,"u0002"),O=O.replace(p,_)}if(e[t]=O.replace(E.REGEX.gm_MOR_2_WSP," "),!T){for(let p in E.NO_SPACE_ITEMS)s=`((?![^{]*})\\s\\${E.NO_SPACE_ITEMS[p]})`,e[t]=e[t].replace(new RegExp(s,"g"),`${E.NO_SPACE_ITEMS[p]}`),s=`((?![^{]*})(\\${E.NO_SPACE_ITEMS[p]}\\s))`,e[t]=e[t].replace(new RegExp(s,"g"),`${E.NO_SPACE_ITEMS[p]}`);e[t]=e[t].replace(/(?![^{]*});(?!\s)/g,"; "),e[t]=e[t].replace(/\s+;/g,";")}e[t]=e[t].replace(/\0/gim," ").replace(/u0001/gim,"	").replace(/u0002/gim,";")}let b=e[t];if(!m&&!T){let O=e[t],p=/\bIF\b/i.test(O),_=/\bTHEN\b/i.test(O),x=/\bENDIF\b/i.test(O),z=p&&_&&x,ee=p&&!_&&/(AND|OR|NOT)\s*$/i.test(O.trim()),W=!1;if(e[t]=e[t].replace(E.REGEX.gm_GET_NESTING,""),e[t].search(new RegExp($,"gi"))!==-1)u++;else if(e[t].search(new RegExp(c,"gi"))!==-1)w=!0;else if(e[t].search(new RegExp(n,"gi"))!==-1)u--,w=!0,u<0&&(u=0,w=!1);else if(e[t].search(new RegExp(d,"gi"))!==-1)u++;else if(e[t].search(new RegExp(h,"gi"))!==-1)w=!0;else if(e[t].search(new RegExp(L,"gi"))!==-1)u--,w=!0,u<0&&(u=0,w=!1);else if(U.EXCLUDE_KEYWORDS.some(A=>{s=`((?![^{]*})(${A}))`,e[t].search(new RegExp(s,"i"))!==-1&&(W=!0)}),B)_&&(u++,w=!0,B=!1);else if(!z)if(ee)B=!0,F=C;else for(let A of U.NESTINGS){if(W||(s=`((?![^{]*})(\\b${A.keyword})\\b)`,e[t].search(new RegExp(s,"i"))!==-1&&u++),A.multiline!==""&&(s=`((?![^{]*})(\\b${A.multiline})\\b)`,e[t].search(new RegExp(s,"i"))),A.middle!==""&&(s=`((?![^{]*})(\\b${A.middle})\\b)`,e[t].search(new RegExp(s,"i"))!==-1)){w=!0;break}if(s=`((?![^{]*})(\\b${A.end})\\b)`,e[t].search(new RegExp(s,"i"))!==-1){u--,u<0&&(u=0),w=!0;break}}}if(!m){let O=o&&e[t].includes("}");if(T||O||o){e[t]=b,B=!1,C!==u&&(C=u);continue}let p=C;B?/\bIF\b/i.test(e[t])&&!/\bTHEN\b/i.test(e[t])||(p=F+2):w&&/\bTHEN\b/i.test(e[t])&&(p=F+2,w=!1);let _=ue(p,w,i);e[t]=_+e[t],C!==u&&(C=u),w=!1}}e=e.map(t=>t.replace(/[ \t]+$/g,""));for(let t=0;t<e.length;t++)t===e.length-1?e[t]!==""&&(l+=e[t],S&&(l+=E.CRLF)):l+=e[t]+E.CRLF;return l.split(E.CRLF).map(t=>{if(t.trim()==="")return t;let o=t.match(/\{[^{}\r\n]*\}/g)||[],m=[],R=t;o.forEach((p,_)=>{let x=`@@C${_}@@`;m.push(p),R=R.replace(p,x)});let b=R.split(/("[^"\\]*(?:\\.[^"\\]*)*"?)/g).filter(p=>p!==""),O="";return b.forEach(p=>{if(p.startsWith('"')&&p.endsWith('"'))O+=p;else{let _=p.match(/^(\s*)(.*)$/);if(_){let x=_[1],z=_[2].replace(/ {2,}/g," ");O+=x+z}else O+=p.replace(/ {2,}/g," ")}}),m.forEach((p,_)=>{O=O.replace(`@@C${_}@@`,p)}),O}).join(E.CRLF)}function ue(r,i,l){let e="";if(r!==0){let s=l.ReplaceTabToSpaces!==!1,u=typeof l.IndentSize=="number"&&l.IndentSize>=1&&l.IndentSize<=10?l.IndentSize:4,C=s?" ".repeat(u):"	";for(let T=0;T<r;T++)i?i=!1:e+=C}return e}function j(r){return r===void 0||r===""||r===`
`||r==="\r"?!0:E.FORMATS.concat(E.SINGLE_OPERATORS,E.DOUBLE_OPERATORS,E.TRENNER).some(i=>r===i)}function Ee(r,i){let l=K(r,i);l=V(l,i);let e=(i.allowedNumberOfEmptyLines||1)+1;if(i.RemoveEmptyLines){let C;i.EmptyLinesAlsoInComment?C=new RegExp(`(?![^{]*})(^[	]*$\r?
){${e},}`,"gm"):C=new RegExp(`(^[	]*$\r?
){${e},}`,"gm"),l=l.replace(C,E.CRLF)}let s=i.ReplaceTabToSpaces!==!1,u=typeof i.IndentSize=="number"&&i.IndentSize>=1&&i.IndentSize<=10?i.IndentSize:4;if(s){let C=/^\t+/gm;l=l.replace(C,T=>" ".repeat(T.length*u))}return l}});var Z=y(M=>{"use strict";Object.defineProperty(M,"__esModule",{value:!0});M.preFormat=pe;M.formatNestings=me;M.fullFormatPipeline=de;var G=X();function pe(r,i){return(0,G.preFormat)(r,i)}function me(r,i){return(0,G.formatNestings)(r,i)}function de(r,i){return(0,G.pureFormatPipeline)(r,i)}});var Y=y(a=>{"use strict";Object.defineProperty(a,"__esModule",{value:!0});a.info=a.config=void 0;a.formatTE=Ce;a.getConfig=Q;a.log=he;a.cloneArray=Se;var v=require("vscode"),I=require("vscode"),q=Z(),Re=D();a.config={};function Ce(r){a.config=Q();let i=I.window.activeTextEditor.document,l=we(r,i,a.config);return[v.TextEdit.replace(r,l)]}function we(r,i,l){let e,s=i.getText(r);s=(0,q.preFormat)(s,l),s=(0,q.formatNestings)(s,l);let u=(l.allowedNumberOfEmptyLines||1)+1;return l.RemoveEmptyLines&&(l.EmptyLinesAlsoInComment?e=new RegExp(`(?![^{]*})(^[	]*$\r?
){${u},}`,"gm"):e=new RegExp(`(^[	]*$\r?
){${u},}`,"gm"),s=s.replace(e,Re.CRLF)),s}function Q(){return a.config.debug=!1,a.config.debugToChannel=!0,a.config.allowedNumberOfEmptyLines=I.workspace.getConfiguration().get("VBI.formatter.EmptyLine.allowedNumberOfEmptyLines"),(a.config.allowedNumberOfEmptyLines<0||a.config.allowedNumberOfEmptyLines>50)&&(a.config.allowedNumberOfEmptyLines=1),a.config.RemoveEmptyLines=I.workspace.getConfiguration().get("VBI.formatter.EmptyLine.RemoveEmptyLines"),a.config.EmptyLinesAlsoInComment=I.workspace.getConfiguration().get("VBI.formatter.EmptyLine.EmptyLinesAlsoInComment"),a.config.BlockCodeBegin=I.workspace.getConfiguration().get("VBI.formatter.BC.BlockCodeBegin"),a.config.BlockCodeEnd=I.workspace.getConfiguration().get("VBI.formatter.BC.BlockCodeEnd"),a.config.BlockCodeExclude=I.workspace.getConfiguration().get("VBI.formatter.BC.BlockCodeExclude"),a.config.RegionBlockCodeBegin=I.workspace.getConfiguration().get("VBI.formatter.Region.BlockCodeBegin"),a.config.RegionBlockCodeEnd=I.workspace.getConfiguration().get("VBI.formatter.Region.BlockCodeEnd"),a.config.RegionBlockCodeExclude=I.workspace.getConfiguration().get("VBI.formatter.Region.BlockCodeExclude"),a.config.ReplaceTabToSpaces=I.workspace.getConfiguration().get("VBI.formatter.Misc.ReplaceTabToSpaces"),a.config.IndentSize=I.workspace.getConfiguration().get("VBI.formatter.Misc.IndentSize"),(typeof a.config.IndentSize!="number"||a.config.IndentSize<1||a.config.IndentSize>10)&&(a.config.IndentSize=4),typeof a.config.ReplaceTabToSpaces!="boolean"&&(a.config.ReplaceTabToSpaces=!0),console.log("getConfig():",a.config),a.config}a.info=v.window.createOutputChannel("VBI-Info");function he(r,...i){function l(e){switch(typeof e){case"undefined":return"undefined";case"object":let s="";for(let[u,C]of Object.entries(e))s+=`${u}: ${C}
`;return s;default:return e}}if(a.config.debug)if(a.config.debugToChannel)switch(r.toLowerCase()){case"info":i.map(s=>{a.info.appendLine("INFO:"+l(s))}),a.info.show();return;case"warn":i.map(s=>{a.info.appendLine("WARN:"+l(s))}),a.info.show();return;case"error":let e="";i.map(s=>{e+=l(s)}),a.info.appendLine(e),v.window.showErrorMessage(e),a.info.show();return;default:i.map(s=>{a.info.appendLine("INFO-Other:"+l(s))}),a.info.show();return}else switch(r.toLowerCase()){case"info":console.log("INFO:",i);return;case"warn":console.log("WARNING:",i);return;case"error":console.error("ERROR:",i);return;default:console.log("log:",r,i);return}else if(r.toLowerCase()==="error"){let e="";i.map(s=>{e+=l(s)}),console.error("ERROR:",i),v.window.showErrorMessage(e);return}}function Se(r){return[...r]}});Object.defineProperty(exports,"__esModule",{value:!0});exports.activate=_e;exports.deactivate=Te;var N=require("vscode"),J=Y();function _e(r){N.commands.registerCommand("vbi-format",()=>{let{activeTextEditor:i}=N.window;if(i){let{document:l}=i,e=new N.Position(0,0),s=new N.Position(l.lineCount-1,l.lineAt(l.lineCount-1).text.length),u=new N.Range(e,s);return(0,J.formatTE)(u)}}),N.languages.registerDocumentFormattingEditProvider({scheme:"file",language:"intouch"},{provideDocumentFormattingEdits(i){let{activeTextEditor:l}=N.window,e=new N.Position(0,0),s=new N.Position(i.lineCount-1,i.lineAt(i.lineCount-1).text.length),u=new N.Range(e,s);return(0,J.formatTE)(u)}})}function Te(){}
//# sourceMappingURL=extension.js.map
